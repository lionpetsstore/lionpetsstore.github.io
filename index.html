<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>èŠæ©å¯µç‰©æ²™é¾ç²¾å“æ—…é¤¨ | Lion Pet Beauty Casa</title>
    
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="apple-touch-icon" href="logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
        // 1. åˆå§‹åŒ– Supabase
        const supabaseUrl = 'https://voicketevnkllfkglicf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZvaWNrZXRldm5rbGxma2dsaWNmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2NTExNDMsImV4cCI6MjA4NDIyNzE0M30.8bSOz-desF2gq_Y63tHo5NsHOjOvt25d1QSYRQ8PI_s';
        
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        // 2. Tailwind è¨­å®š
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        lion: {
                            navy: '#1B365D',      /* æ·±æµ·è»è— */
                            gold: '#C5A065',      /* é¦™æª³é‡‘ */
                            light: '#F5F5F7',     /* æ·ºç°ç™½ */
                            line: '#06C755',      /* LINE ç¶ è‰² */
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                        serif: ['"Playfair Display"', 'serif']
                    },
                    animation: {
                        'scroll': 'scroll 25s linear infinite',
                        'fade-in': 'fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1) forwards',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards',
                        'slide-down': 'slideDown 0.3s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'float': 'float 10s infinite ease-in-out',
                        'float-delayed': 'float 12s infinite ease-in-out reverse',
                    },
                    keyframes: {
                        scroll: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(-50%)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(100%)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideDown: {
                            '0%': { opacity: '0', transform: 'translateY(-10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translate(0, 0)' },
                            '50%': { transform: 'translate(0, 20px)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F5F5F7;
            color: #1B365D;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* ç»ç’ƒæ“¬æ…‹ */
        .glass-premium {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 40px -10px rgba(27, 54, 93, 0.1);
            border-radius: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .glass-premium::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0) 100%);
            pointer-events: none; z-index: 0;
        }

        .bg-orb { position: fixed; border-radius: 50%; filter: blur(80px); z-index: -1; opacity: 0.6; }

        .cute-input { 
            background: rgba(255, 255, 255, 0.6); 
            border: 1px solid #E2E8F0; 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: #1B365D; font-size: 0.95rem; backdrop-filter: blur(4px);
        }
        .cute-input:focus { 
            background: #ffffff; border-color: #1B365D; outline: none; 
            box-shadow: 0 0 0 4px rgba(27, 54, 93, 0.1);
            transform: translateY(-1px);
        }

        .radio-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
            border: 1px solid #E2E8F0; 
            background: rgba(255, 255, 255, 0.5);
            position: relative; overflow: hidden;
        }
        .radio-card:hover { border-color: #C5A065; background: rgba(255, 255, 255, 0.8); }
        .radio-card:active { transform: scale(0.98); }
        
        .radio-card.selected {
            background-color: #fff; 
            border-color: #1B365D; border-width: 2px;
            box-shadow: 0 8px 20px -4px rgba(27, 54, 93, 0.15);
        }
        .radio-card.danger.selected { background-color: #FEF2F2; border-color: #EF4444; }

        .fullscreen-signature { position: fixed; inset: 0; z-index: 100; background: white; display: flex; flex-direction: column; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div class="bg-orb w-96 h-96 bg-blue-100 top-[-10%] left-[-10%] animate-float"></div>
    <div class="bg-orb w-80 h-80 bg-orange-100 bottom-[-10%] right-[-10%] animate-float-delayed"></div>
    <div class="bg-orb w-64 h-64 bg-purple-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 animate-pulse-slow"></div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

const mockSubmit = async (data, currentView) => {
    // 1. æº–å‚™å¯«å…¥ bookings çš„è³‡æ–™
    const bookingData = {
        service_type: currentView === 'boarding' ? 'boarding' : 'grooming',
        owner_name: data.owner_name,
        phone: data.phone,
        email: data.email,
        owner_id: data.owner_id,
        address: data.address,
        emergency_name: data.emergency_name,
        emergency_phone: data.emergency_phone,
        pet_name: data.pet_name,
        pet_type: data.pet_type,
        breed: data.breed,
        weight: data.weight || 0,
        age_type: data.age_type,
        age_value: data.age_value || 0,
        sex: data.sex,
        fix: data.fix,
        chip_status: data.chip_status,
        chip_id: data.chip_id,
        health_date: data.health_date || null,
        deworming_monthly: data.deworming_monthly,
        physical_check: data.physical_check,
        physical_other: data.physical_other,
        social_traits: data.social_traits,
        personality_other: data.personality_other,
        medical_history: data.medical_history,
        medical_tags: data.medical_tags,
        medical_other: data.medical_other,
        preferred_clinic_name: data.preferred_clinic_name,
        preferred_clinic_phone: data.preferred_clinic_phone,
        check_in_date: data.checkInDate || null,
        check_out_date: data.checkOutDate || null,
        room_type: data.room_type,
        room_price: data.room_price || 0,
        temperament: data.temperament,
        service_tags: data.service_tags,
        note: data.note,
        total_amount: data.total_amount || 0,
        payment_method: data.payment_method,
        deposit: data.deposit || 0,
        balance: data.balance || 0,
        signature: data.signature,
        signature_time: new Date().toISOString(),
        legal_agree: data.legal_agree
    };

    // 2. å¯«å…¥ bookings
    const { error: bookingError } = await supabaseClient.from('bookings').insert([bookingData]);
    if (bookingError) {
        console.error('Booking Error:', bookingError);
        throw new Error('é ç´„å–®é€å‡ºå¤±æ•—');
    }

    // 3. æ›´æ–°æˆ–æ–°å¢ customers (ä½¿ç”¨ upsert)
    const customerData = {
        phone: data.phone,
        owner_name: data.owner_name,
        owner_id: data.owner_id,
        email: data.email,
        address: data.address,
        emergency_name: data.emergency_name,
        emergency_phone: data.emergency_phone,
        updated_at: new Date().toISOString()
    };
    const { error: customerError } = await supabaseClient.from('customers').upsert(customerData, { onConflict: 'phone' });
    
    if (customerError) console.error('Customer Update Error:', customerError);

    return { status: 'success' };
};

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (iconRef.current && window.lucide) {
                    iconRef.current.innerHTML = '';
                    const i = document.createElement('i');
                    i.setAttribute('data-lucide', name);
                    i.style.width = '100%';
                    i.style.height = '100%';
                    iconRef.current.appendChild(i);
                    window.lucide.createIcons({ root: iconRef.current });
                }
            }, [name]);
            return <span ref={iconRef} style={{ width: size, height: size, display: 'inline-flex' }} className={className} />;
        };

        const Marquee = () => {
            const images = [
                'line_oa_chat_260121_230912_group_0.jpg', 'line_oa_chat_260121_230912_group_1.jpg',
                'line_oa_chat_260121_230912_group_2.jpg', 'line_oa_chat_260121_230908_group_0.jpg',
                'line_oa_chat_260121_230908_group_1.jpg', 'line_oa_chat_260121_230908_group_2.jpg'
            ];
            return (
                <div className="w-full overflow-hidden relative h-48 md:h-64 rounded-[2rem] mb-10 glass-premium border-0 shadow-2xl group transform hover:scale-[1.01] transition-transform duration-500">
                    <div className="absolute inset-0 z-10 bg-lion-navy/5 pointer-events-none group-hover:bg-transparent transition-colors"></div>
                    <div className="flex w-[200%] animate-scroll h-full">
                        {[...images, ...images].map((src, idx) => (
                            <div key={idx} className="w-1/3 h-full flex-shrink-0 px-2 py-2">
                                <img src={src} className="w-full h-full object-cover rounded-2xl shadow-sm" alt="Environment" onError={(e)=>{e.target.style.display='none'}} />
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

// --- æ–°çš„ Toast ç³»çµ± ---
const ToastContainer = () => {
    const [toasts, setToasts] = useState([]);

    const addToast = (message, type = 'info', duration = 5000) => {
        const id = Date.now();
        setToasts(prev => [...prev, { id, message, type, duration }]);
        
        // è‡ªå‹•ç§»é™¤
        setTimeout(() => {
            removeToast(id);
        }, duration);
    };

    const removeToast = (id) => {
        setToasts(prev => prev.filter(toast => toast.id !== id));
    };

    // æš´éœ²æ–¹æ³•åˆ°å…¨å±€
    useEffect(() => {
        window.showToast = addToast;
        window.removeToast = removeToast;
    }, []);

    return (
        <div className="fixed top-6 left-1/2 -translate-x-1/2 z-[200] flex flex-col gap-3 w-full max-w-md px-4 pointer-events-none">
            {toasts.map(toast => (
                <ToastItem 
                    key={toast.id} 
                    {...toast} 
                    onClose={() => removeToast(toast.id)} 
                />
            ))}
        </div>
    );
};

const ToastItem = ({ id, message, type = 'info', duration = 5000, onClose }) => {
    const [progress, setProgress] = useState(100);
    const [isVisible, setIsVisible] = useState(false);

    // é€²åº¦æ¢å‹•ç•«
    useEffect(() => {
        setIsVisible(true);
        const interval = setInterval(() => {
            setProgress(prev => {
                if (prev <= 0) {
                    clearInterval(interval);
                    return 0;
                }
                return prev - (100 / (duration / 100));
            });
        }, 100);

        return () => clearInterval(interval);
    }, [duration]);

    // é€€å‡ºå‹•ç•«
    const handleClose = () => {
        setIsVisible(false);
        setTimeout(onClose, 300);
    };

    const typeStyles = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-orange-500',
        info: 'bg-blue-500'
    };

    const icons = {
        success: 'check-circle',
        error: 'alert-circle',
        warning: 'alert-triangle',
        info: 'info'
    };

    return (
        <div 
            className={`pointer-events-auto transform transition-all duration-300 ${
                isVisible ? 'translate-y-0 opacity-100' : 'translate-y-[-20px] opacity-0'
            }`}
        >
            <div className={`${typeStyles[type]} text-white px-6 py-4 rounded-2xl shadow-2xl flex items-start gap-3 relative overflow-hidden`}>
                <Icon name={icons[type]} size={20} className="mt-0.5 shrink-0" />
                <div className="flex-1 text-sm font-bold whitespace-pre-wrap text-left">
                    {message}
                </div>
                <button 
                    onClick={handleClose}
                    className="ml-2 p-1 hover:bg-white/20 rounded-full transition-colors"
                >
                    <Icon name="x" size={16} />
                </button>
                <div 
                    className="absolute bottom-0 left-0 h-1 bg-white/30 transition-all duration-100"
                    style={{ width: `${progress}%` }}
                />
            </div>
        </div>
    );
};

const InputWithError = ({ label, name, type = 'text', value, onChange, placeholder, error, className = '', ...props }) => (
    <div className="space-y-2 w-full relative z-10">
        {label && <label className="text-xs font-bold text-lion-navy/70 ml-1 tracking-wide">{label}</label>}
        <input 
            name={name} 
            type={type} 
            value={value} 
            onChange={onChange} 
            className={`w-full cute-input rounded-xl px-4 py-3.5 font-bold text-lion-navy placeholder-slate-300 ${error ? 'border-red-500 bg-red-50/50' : ''} ${className}`} 
            placeholder={placeholder} 
            {...props}
        />
        {error && <div className="text-xs text-red-500 font-bold mt-1">{error}</div>}
    </div>
);



        const TermsModal = ({ isOpen, onClose, title, children, onAgree }) => {
            const contentRef = useRef(null);
            const [canAgree, setCanAgree] = useState(false);

            useEffect(() => {
                if (isOpen) {
                    setCanAgree(false);
                    document.body.style.overflow = 'hidden';
                    setTimeout(() => {
                        if (contentRef.current && contentRef.current.scrollHeight <= contentRef.current.clientHeight + 10) {
                            setCanAgree(true);
                        }
                    }, 300);
                } else {
                    document.body.style.overflow = '';
                }
            }, [isOpen]);

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollHeight - scrollTop - clientHeight < 50) setCanAgree(true);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[150] bg-lion-navy/40 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in">
                    <div className="bg-white w-full max-w-lg rounded-3xl shadow-2xl flex flex-col max-h-[85vh] animate-slide-up">
                        <div className="px-6 py-5 border-b border-slate-100 flex justify-between items-center shrink-0">
                            <h3 className="text-lg font-serif font-bold text-lion-navy">{title}</h3>
                            <button onClick={onClose} className="p-2 bg-slate-50 rounded-full hover:bg-slate-100 transition-colors">
                                <Icon name="x" size={20} className="text-slate-400" />
                            </button>
                        </div>
                        <div ref={contentRef} onScroll={handleScroll} className="flex-1 overflow-y-auto p-6 text-sm text-slate-600 leading-relaxed space-y-4">
                            {children}
                            <div className="h-10"></div>
                        </div>
                        <div className="p-6 border-t border-slate-100 bg-white md:rounded-b-3xl shrink-0 safe-area-bottom">
                            {!canAgree && (
                                <div className="text-center text-xs font-bold text-lion-gold mb-3 animate-pulse">ğŸ‘‡ è«‹æ»‘å‹•è‡³æœ€åº•éƒ¨ä»¥åŒæ„æ¢æ¬¾</div>
                            )}
                            <button onClick={() => { if(canAgree) { onAgree && onAgree(); onClose(); } }} disabled={!canAgree}
                                className={`w-full py-4 rounded-xl font-bold text-base flex items-center justify-center gap-2 transition-all ${canAgree ? 'bg-lion-navy text-white shadow-lg shadow-lion-navy/20 active:scale-95 hover:bg-[#2A4B7C]' : 'bg-slate-100 text-slate-400 cursor-not-allowed'}`}>
                                <Icon name={canAgree ? "check-circle" : "lock"} size={20} />
                                {canAgree ? "æˆ‘å·²è©³é–±ä¸¦åŒæ„" : "è«‹é–±è®€å®Œç•¢"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
// --- èˆŠå®¢è³‡æ–™é¸æ“‡ Modal ---
const HistoryModal = ({ records, onClose, onSelect }) => {
    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-[#5D4D41]/40 backdrop-blur-sm animate-in fade-in duration-300">
            <div className="w-full max-w-md bg-white dark:bg-gray-800 rounded-3xl overflow-hidden shadow-2xl relative max-h-[80vh] flex flex-col">
                <div className="bg-[#736357] p-6 text-white text-center">
                    <h3 className="text-xl font-bold">ğŸ‰ æ­¡è¿å›ä¾†ï¼</h3>
                    <p className="text-sm opacity-80 mt-1">æˆ‘å€‘æ‰¾åˆ°äº†ä»¥ä¸‹å¯¶è²çš„ç´€éŒ„ï¼Œè«‹é¸æ“‡è¦å¸¶å…¥çš„è³‡æ–™ï¼š</p>
                </div>
<div className="p-6 space-y-3 overflow-y-auto bg-[#fbf9f6] dark:bg-gray-900 min-h-[200px]">
                    {records.map((record, index) => {
                        const petName = record.pet_name || 'æœªå‘½åå¯¶è²';
                        const serviceType = record.service_type === 'boarding' ? 'ä½å®¿' : 'ç¾å®¹';
                        
                        // é˜²å‘†è™•ç†ï¼šå¦‚æœæ²’æœ‰æ—¥æœŸï¼Œå°±ä¸é¡¯ç¤ºäº‚ç¢¼æˆ–éŒ¯èª¤
                        let dateStr = 'ç„¡æ—¥æœŸç´€éŒ„';
                        if (record.created_at) {
                            try {
                                const dateObj = new Date(record.created_at);
                                if (!isNaN(dateObj.getTime())) {
                                    dateStr = `${dateObj.getFullYear()}/${(dateObj.getMonth()+1).toString().padStart(2,'0')}/${dateObj.getDate().toString().padStart(2,'0')}`;
                                }
                            } catch (e) { console.error('Date parse error', e); }
                        }
                        
                        return (
                            <button key={record.id || index} onClick={() => onSelect(record)} 
                                className="w-full bg-white dark:bg-gray-800 p-4 rounded-2xl border border-slate-100 dark:border-gray-700 shadow-sm hover:border-[#F7E7B5] hover:shadow-md transition-all text-left flex items-center gap-4 group">
                                <div className="w-12 h-12 rounded-full bg-[#F7E7B5]/20 flex items-center justify-center text-[#736357] font-bold text-lg group-hover:bg-[#F7E7B5] transition-colors">
                                    {petName.charAt(0)}
                                </div>
                                <div>
                                    <div className="font-bold text-[#736357] dark:text-[#F7E7B5] text-lg">{petName}</div>
                                    <div className="text-xs text-slate-400">ä¸Šæ¬¡æœå‹™ï¼š{dateStr} ({serviceType})</div>
                                </div>
                                <div className="ml-auto text-[#736357] dark:text-[#F7E7B5] opacity-0 group-hover:opacity-100 transition-opacity">
                                    <Icon name="arrow-right" size={20} />
                                </div>
                            </button>
                        );
                    })}
                </div>
                <div className="p-4 bg-white dark:bg-gray-800 border-t border-slate-100 dark:border-gray-700">
                    <button onClick={onClose} className="w-full py-3 rounded-xl text-slate-400 font-bold text-sm hover:bg-slate-50 dark:hover:bg-gray-700 transition-colors">
                        ä¸ä½¿ç”¨èˆŠè³‡æ–™ï¼Œå¡«å¯«æ–°è¡¨å–®
                    </button>
                </div>
            </div>
        </div>
    );
};

        const App = () => {
    // --- é©—è­‰è¦å‰‡é…ç½® ---
const validationRules = {
    // åŸºæœ¬è³‡æ–™
    owner_name: { required: true, message: 'è«‹è¼¸å…¥ä¸»äººå§“å' },
    is_owner: 'æ˜¯',  // é è¨­ç‚ºæ˜¯
    phone: {
        required: true,
        pattern: /^09\d{8}$/,
        message: 'è«‹è¼¸å…¥æ­£ç¢ºçš„æ‰‹æ©Ÿè™Ÿç¢¼æ ¼å¼ (09xxxxxxxx)'
    },
    email: {
        required: true,
        pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
        message: 'è«‹è¼¸å…¥æ­£ç¢ºçš„é›»å­éƒµä»¶æ ¼å¼'
    },
    owner_id: {
        required: true,
        pattern: /^[A-Z][12]\d{8}$/,
        message: 'è«‹è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰å­—è™Ÿæ ¼å¼'
    },
    address: { required: true, message: 'è«‹è¼¸å…¥è¯çµ¡åœ°å€' },
    emergency_name: { required: true, message: 'è«‹è¼¸å…¥ç·Šæ€¥è¯çµ¡äººå§“å' },
    emergency_phone: { required: true, message: 'è«‹è¼¸å…¥ç·Šæ€¥è¯çµ¡äººé›»è©±' },
    
    // å¯µç‰©è³‡æ–™
    pet_name: { required: true, message: 'è«‹è¼¸å…¥å¯µç‰©åå­—' },
    pet_type: { required: true, message: 'è«‹é¸æ“‡å¯µç‰©ç¨®é¡' },
    breed: { required: true, message: 'è«‹è¼¸å…¥å“ç¨®' },
    weight: { required: true, message: 'è«‹è¼¸å…¥é«”é‡' },
    age_value: { required: true, message: 'è«‹è¼¸å…¥å¹´é½¡' },
    age_type: { required: true, message: 'è«‹é¸æ“‡å¹´é½¡å–®ä½' },
    sex: { required: true, message: 'è«‹é¸æ“‡æ€§åˆ¥' },
    fix: { required: true, message: 'è«‹é¸æ“‡æ˜¯å¦çµç´®' },
    chip_status: { required: true, message: 'è«‹é¸æ“‡æ™¶ç‰‡ç‹€æ…‹' },
    medical_history: { required: true, message: 'è«‹é¸æ“‡éå¾€ç—…å²' },
    deworming_monthly: { required: true, message: 'è«‹é¸æ“‡æ˜¯å¦æ¯æœˆå®šæœŸé©…èŸ²' },
    physical_check: { required: true, message: 'è«‹é¸æ“‡å¤–è§€æª¢æŸ¥é …ç›®' },
    social_traits: { required: true, message: 'è«‹é¸æ“‡å¯µç‰©å€‹æ€§' },
    
    // ä»˜æ¬¾è³‡æ–™
    payment_method: { required: true, message: 'è«‹é¸æ“‡ä»˜æ¬¾æ–¹å¼' },
    total_amount: { required: true, message: 'è«‹è¼¸å…¥ç¸½é‡‘é¡' },
};


    // --- é©—è­‰å‡½æ•¸ ---
const validateField = (name, value) => {
    const rule = validationRules[name];
    if (!rule) return null;

    if (rule.required && !value) {
        return rule.message || 'æ­¤æ¬„ä½ç‚ºå¿…å¡«';
    }

    if (rule.pattern && !rule.pattern.test(value)) {
        return rule.message || 'æ ¼å¼ä¸æ­£ç¢º';
    }

    return null;
};

    // --- è¡¨å–®é©—è­‰ Hook ---
    const [errors, setErrors] = useState({});
    
const validate = () => {
    const newErrors = {};
    let hasError = false;

    // æª¢æŸ¥æ‰€æœ‰å®šç¾©çš„é©—è­‰è¦å‰‡
    Object.keys(validationRules).forEach(key => {
        const error = validateField(key, formData[key]);
        if (error) {
            newErrors[key] = error;
            hasError = true;
        }
    });

    // æª¢æŸ¥ä½å®¿å°ˆç”¨æ¬„ä½
    if (view === 'boarding') {
        if (!formData.checkInDate) {
            newErrors.checkInDate = 'è«‹é¸æ“‡å…¥ä½æ—¥æœŸ';
            hasError = true;
        }
        if (!formData.checkOutDate) {
            newErrors.checkOutDate = 'è«‹é¸æ“‡é€€æˆ¿æ—¥æœŸ';
            hasError = true;
        }
        if (!formData.room_type) {
            newErrors.room_type = 'è«‹é¸æ“‡æˆ¿å‹';
            hasError = true;
        }
        if (!formData.temperament) {
            newErrors.temperament = 'è«‹é¸æ“‡æ”¾é¢¨æ¨¡å¼';
            hasError = true;
        }
        // æª¢æŸ¥è¨‚é‡‘å’Œå°¾æ¬¾
        if (!formData.deposit) {
            newErrors.deposit = 'è«‹è¼¸å…¥å·²æ”¯ä»˜è¨‚é‡‘';
            hasError = true;
        }
        if (!formData.balance) {
            newErrors.balance = 'è«‹è¼¸å…¥å°¾æ¬¾é‡‘é¡';
            hasError = true;
        }
    }

    // æª¢æŸ¥ç¾å®¹æœå‹™
    if (view === 'grooming' && (!formData.service_tags || formData.service_tags.length === 0)) {
        newErrors.service_tags = 'è«‹è‡³å°‘é¸æ“‡ä¸€é …ç¾å®¹æœå‹™';
        hasError = true;
    }



    // æª¢æŸ¥æ•¸ä½ç°½å
    if (!formData.signature) {
        newErrors.signature = 'è«‹å®Œæˆæ•¸ä½ç°½å';
        hasError = true;
    }

    setErrors(newErrors);

    if (hasError) {
        // åªé¡¯ç¤ºå‰3å€‹éŒ¯èª¤ï¼Œé¿å…éå¤šéŒ¯èª¤è¨Šæ¯
        const errorKeys = Object.keys(newErrors);
        const topErrors = errorKeys.slice(0, 3).map(key => newErrors[key]);
        const remainingCount = errorKeys.length - 3;
        
        let message = 'è«‹ä¿®æ­£ä»¥ä¸‹éŒ¯èª¤ï¼š\n' + topErrors.join('\n');
        if (remainingCount > 0) {
            message += `\n\né‚„æœ‰ ${remainingCount} å€‹æ¬„ä½éœ€è¦ä¿®æ­£`;
        }
        
        window.showToast(message, 'error');
        
        // æ»¾å‹•åˆ°ç¬¬ä¸€å€‹éŒ¯èª¤æ¬„ä½
        const firstErrorField = document.querySelector(`[name="${errorKeys[0]}"]`);
        if (firstErrorField) {
            firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    return !hasError;
};


const clearError = (name) => {
    setErrors(prev => {
        const newErrors = { ...prev };
        delete newErrors[name];
        return newErrors;
    });
};


            const [view, setView] = useState('home');
            
            const [formData, setFormData] = useState({
                lineAdded: false, email: '', owner_name: '', is_owner: 'æ˜¯', phone: '', owner_id: '', address: '',
                emergency_name: '', emergency_phone: '',
                preferred_clinic_name: '', preferred_clinic_phone: '',
                pet_name: '', breed: '', weight: '', age_type: 'year', age_value: '',
                pet_type: 'dog', sex: '', fix: '', chip_status: '', chip_id: '',
                health_date: '', deworming_monthly: '',
                physical_check: [], physical_other: '', 
                social_traits: [], personality_other: '',
                medical_history: 'ç„¡', medical_tags: [], medical_other: '',
                vet_name: '', vet_phone: '',
                service_tags: [], room_type: '', room_price: '', checkInDate: '', checkOutDate: '',
                is_barking: '', has_boarding_exp: '', is_food_aggressive: '', use_peepad: '',
                vaccine_status: '', deworming_status: '', cage_training: '', temperament: '',
                food_allergy: '', personality_note: '', special_note: '', additional_notes: '',
                total_amount: '', payment_method: '', deposit: '', balance: '',
                signature: null, signature_time: '',
                legal_agree: false, service_type: ''
            });
            // æ–°å¢ï¼šèˆŠå®¢æŸ¥è©¢ç›¸é—œç‹€æ…‹
const [isSearching, setIsSearching] = useState(false);
const [showHistoryModal, setShowHistoryModal] = useState(false);
const [historyRecords, setHistoryRecords] = useState([]);

            const roomRates = {
                cat: [
                    { name: 'æ¨™æº–æˆ¿', price: 600, desc: 'èˆ’é©ç¨ç«‹ç©ºé–“' },
                    { name: 'è±ªè¯æˆ¿', price: 800, desc: 'è·³å°ç©å…·è±å¯Œ' },
                    { name: 'å®¶åº­æˆ¿', price: 1200, desc: 'å¤šè²“å…±äº«å¤§ç©ºé–“' }
                ],
                dog: [
                    { name: 'å°å‹çŠ¬æ¨™æº–æˆ¿', price: 500, desc: '5å…¬æ–¤ä»¥ä¸‹' },
                    { name: 'æ¨™æº–æˆ¿', price: 600, desc: 'ä¸€èˆ¬å°å‹çŠ¬' },
                    { name: 'è±ªè¯æˆ¿', price: 800, desc: 'å¯¬æ•ä¸æ“æ“ ' },
                    { name: 'VIPæˆ¿', price: 1300, desc: 'ç‰¹å¤§ç¨ç«‹ç©ºé–“' }
                ]
            };
            
            const personalityOptions = ['åˆ†é›¢ç„¦æ…®', 'ç·Šå¼µ', 'è†½å°', 'è­·é£Ÿ', '+ å…¶ä»–'];

            const [isSubmitting, setIsSubmitting] = useState(false);
            const [showSuccess, setShowSuccess] = useState(false);
            
            const [showFullSig, setShowFullSig] = useState(false);
            const [realtimeSig, setRealtimeSig] = useState(null);
            const fullSigCanvasRef = useRef(null);
            const padInstance = useRef(null);
            const [lineConfirmed, setLineConfirmed] = useState(false);

            const [activeModal, setActiveModal] = useState(null);
            const [termsRead, setTermsRead] = useState({ beauty: false, boarding: false, highRiskBeauty: false, highRiskBoarding: false });

            // --- Risk Assessment Logic ---
            const checkHighRisk = (data) => {
                //1. ç—…å²ç‚ºã€Œæœ‰ã€ (è®Šæ•¸ä¿®æ­£ï¼šmedical_history)
                if (data.medical_history === 'æœ‰') return true;
                
                // 2. å¹´é½¡åˆ¤æ–·
                const num = parseFloat(data.age_value);
                if (isNaN(num)) return false; 

                // æ¨¡å¼ A: æœªæ»¿1æ­² (å–®ä½ï¼šæœˆ) -> 3 å€‹æœˆä»¥ä¸‹(å«)ç‚ºé«˜é¢¨éšª
                if (data.age_type === 'month') {
                    if (num <= 3) return true;
                }
                // æ¨¡å¼ B: 1æ­²ä»¥ä¸Š (å–®ä½ï¼šæ­²) -> 8 æ­²ä»¥ä¸Šç‚ºé«˜é¢¨éšª
                else if (data.age_type === 'year') {
                    if (num >= 8) return true;
                }
                
                return false;
            };

            const isHighRisk = useMemo(() => checkHighRisk(formData), [formData]);

            const allTermsCompleted = useMemo(() => {
                if (!termsRead.beauty) return false;
                if (view === 'boarding' && !termsRead.boarding) return false;
                
                if (isHighRisk) {
                    if (!termsRead.highRiskBeauty) return false;
                    if (view === 'boarding' && !termsRead.highRiskBoarding) return false;
                }
                return true;
            }, [termsRead, view, isHighRisk]);

            const handleTermAgree = (type) => {
                setTermsRead(prev => ({ ...prev, [type]: true }));
                setFormData(prev => ({ ...prev, legal_agree: true })); 
            };

            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash.slice(1);
                    if (['grooming', 'boarding', 'home'].includes(hash)) {
                        setView(hash);
                        window.scrollTo(0, 0);
                    } else {
                        setView('home');
                    }
                };
                window.addEventListener('hashchange', handleHashChange);
                handleHashChange();
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const updateHash = (newView) => window.location.hash = newView;
            

const handleChange = (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    clearError(field);
};



            const toggleArray = (field, value) => {
                setFormData(prev => {
                    const arr = prev[field] || [];
                    return { ...prev, [field]: arr.includes(value) ? arr.filter(i=>i!==value) : [...arr, value] };
                });
            };
// --- æ–°å¢ï¼šæœå°‹èˆŠå®¢è³‡æ–™é‚è¼¯ ---
const handleSearchHistory = async () => {
    const phone = formData.phone;
    if (!phone || phone.length < 9) {
        window.showToast("âš ï¸ è«‹å…ˆè¼¸å…¥å®Œæ•´çš„é€£çµ¡é›»è©±", "error");
        return;
    }

    setIsSearching(true);
    try {
        // å‘¼å« Supabase æŸ¥è©¢ bookings è¡¨ï¼Œä¾æ™‚é–“å€’åºæ’åˆ—
        const { data, error } = await supabaseClient
            .from('bookings')
            .select('*')
            .eq('phone', phone)
            .order('created_at', { ascending: false });

        if (error) throw error;

        if (!data || data.length === 0) {
            window.showToast("ğŸ” æŸ¥ç„¡æ­¤é›»è©±çš„éå¾€ç´€éŒ„", "error");
        } else {
            // ä½¿ç”¨ Map ä¾†å»é‡ä¸¦é¸æ“‡æœ€é©åˆçš„ç´€éŒ„
            const uniquePets = new Map();
            
data.forEach(record => {
                // ä¿®æ­£ï¼šç›´æ¥è®€å– record çš„æ¬„ä½ï¼Œä¸ä½¿ç”¨ raw_data
                if (!record.pet_name) return;
                
                const petName = record.pet_name;
                
                // ä¿®æ­£ï¼šåˆ¤æ–·ä½å®¿æˆ–ç¾å®¹ï¼Œç›´æ¥çœ‹ service_type æ¬„ä½
                const isRecordBoarding = record.service_type === 'boarding';

                // é‚è¼¯ï¼š
                // 1. å¦‚æœ Map è£¡é‚„æ²’é€™å€‹åå­— -> ç›´æ¥åŠ å…¥
                // 2. å¦‚æœ Map è£¡å·²ç¶“æœ‰é€™å€‹åå­—ï¼Œåˆ¤æ–·æ˜¯å¦éœ€è¦ã€Œå‡ç´šã€ç´€éŒ„
                //    - å¦‚æœç¾åœ¨åœ¨ä½å®¿é é¢ (view === 'boarding')ï¼Œä½†èˆŠç´€éŒ„æ˜¯ç¾å®¹ï¼Œè€Œæ–°æ‰¾åˆ°çš„æ˜¯ä½å®¿ -> æ›¿æ›
                if (!uniquePets.has(petName)) {
                    uniquePets.set(petName, record);
                } else {
                    const existingRecord = uniquePets.get(petName);
                    const existingIsBoarding = existingRecord.service_type === 'boarding';
                    
                    if (view === 'boarding' && !existingIsBoarding && isRecordBoarding) {
                        uniquePets.set(petName, record);
                    }
                }
            });
                        
            const records = Array.from(uniquePets.values());
            setHistoryRecords(records);
            setShowHistoryModal(true);
        }
    } catch (err) {
        console.error("Search Error:", err);
        window.showToast("âŒ æŸ¥è©¢å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯", "error");
    } finally {
        setIsSearching(false);
    }
};
// è¼”åŠ©å‡½æ•¸ï¼šå®‰å…¨åœ°è§£æå­—ä¸²æˆ–é™£åˆ—
const safeParse = (value) => {
  // 1. å¦‚æœæ˜¯ç©ºå€¼ï¼Œå›å‚³ç©ºé™£åˆ—
  if (!value) return [];
  
  // 2. å¦‚æœå·²ç¶“æ˜¯é™£åˆ—ï¼Œç›´æ¥å›å‚³
  if (Array.isArray(value)) return value;
  
  // 3. å¦‚æœæ˜¯å­—ä¸²ï¼Œå˜—è©¦è§£æ
  if (typeof value === 'string') {
    try {
      // å˜—è©¦è§£æ JSON (ä¾‹å¦‚ "[\"æ­£å¸¸\"]")
      return JSON.parse(value);
    } catch (e) {
      // 4. å¦‚æœè§£æå¤±æ•—ï¼ˆä¾‹å¦‚æ˜¯å–®ç´”å­—ä¸² "æ­£å¸¸"ï¼‰ï¼Œå°‡å…¶åŒ…è£æˆé™£åˆ—
      return [value];
    }
  }
  
  // 5. å…¶ä»–æƒ…æ³å›å‚³ç©ºé™£åˆ—
  return [];
};

// --- æ–°å¢ï¼šå¸¶å…¥èˆŠè³‡æ–™é‚è¼¯ ---
const handleApplyHistory = (record) => {
    const oldData = record;

    // --- è™•ç†ç–«è‹—ç…§ç‰‡é‚è¼¯ ---
    let savedVaccinePhoto = null;
    if (oldData.vaccine === 'æœ‰') {
        if (record.vaccine_url) {
            savedVaccinePhoto = record.vaccine_url;
        } else if (oldData.vaccine_file && oldData.vaccine_file.startsWith('http')) {
            savedVaccinePhoto = oldData.vaccine_file;
        }
    }

    // --- è§£æ§‹èˆŠè³‡æ–™ ---
    const { 
        checkInDate, checkOutDate, 
        service_tags, 
        signature, signature_time, legal_agree, 
        vaccine_file,
        // æ’é™¤é‡‘é¡ç›¸é—œæ¬„ä½
        total_amount,
        payment_method,
        deposit,
        balance,
        ...reusableData 
    } = oldData;

    // --- æ›´æ–°è¡¨å–®è³‡æ–™ ---
    setFormData(prev => ({
        ...prev,            // ä¿ç•™ç›®å‰è¡¨å–®çš„ç‹€æ…‹ (ä¾‹å¦‚å·²é¸å¥½çš„æœå‹™é¡åˆ¥)
        ...reusableData,    // è¦†è“‹èˆŠå®¢çš„è³‡æ–™ (å§“åã€é›»è©±ã€å“ç¨®ã€å€‹æ€§...)
        phone: formData.phone, // ç¢ºä¿é›»è©±æ˜¯å‰›å‰›æœå°‹çš„é‚£æ”¯
        
        // ğŸ‘‡ é—œéµä¿®æ”¹ï¼šä½¿ç”¨ safeParse è™•ç†é€™å…©å€‹æ¬„ä½ï¼Œé¿å…å ±éŒ¯
        physical_check: safeParse(record.physical_check),
        social_traits: safeParse(record.social_traits),
        
        // ğŸ‘‡ è™•ç†å…¶ä»–é™£åˆ—æ¬„ä½
        medical_tags: safeParse(reusableData.medical_tags),
        
        service_tags: [], // ğŸ‘ˆ é€™è£¡å¼·åˆ¶æ¸…ç©ºï¼Œä¸è¦å¸¶å…¥èˆŠçš„æœå‹™é …ç›®
        
        weight: reusableData.weight || '',
        age_value: reusableData.age_value || '',
        age_type: reusableData.age_type || 'year',
        preferred_clinic_name: reusableData.preferred_clinic_name || '',
        preferred_clinic_phone: reusableData.preferred_clinic_phone || '',
        deworming_monthly: reusableData.deworming_monthly || '',
        vaccine_file: savedVaccinePhoto, // è¨­å®šç–«è‹—ç…§ç‰‡
        
        // ğŸ‘‡ é—œéµä¿®æ”¹ï¼šç¢ºä¿é‡‘é¡æ¬„ä½ç‚ºç©º
        total_amount: '',
        payment_method: '',
        deposit: '',
        balance: ''
    }));

    setRealtimeSig(null);
    setShowHistoryModal(false);
    
    // --- æç¤ºè¨Šæ¯ï¼šåˆ¤æ–·ä¾†æºæ˜¯ä½å®¿é‚„æ˜¯ç¾å®¹ ---
    const isSourceBoarding = oldData.service_type === 'boarding';
    if (view === 'boarding' && !isSourceBoarding) {
        window.showToast(`âœ… å·²å¸¶å…¥ ${oldData.pet_name} è³‡æ–™ (æé†’: æ­¤ç‚ºç¾å®¹ç´€éŒ„ï¼Œè«‹è£œå¡«ä½å®¿å°ˆç”¨æ¬„ä½)`, "success");
    } else {
        window.showToast(`âœ… å·²å¸¶å…¥ ${oldData.pet_name} çš„éå¾€è³‡æ–™`, "success");
    }
};


// è¼”åŠ©ï¼šåˆ¤æ–·ç©ºå€¼
    const isEmpty = (val) => {
        if (val === null || val === undefined) return true;
        if (Array.isArray(val) && val.length === 0) return true;
        if (typeof val === 'string') return val.trim() === '';
        return false;
    };
    // éŒ¯èª¤æ¬„ä½æ¸…å–® (æ”¶é›†ä¸­æ–‡åç¨±)
    const missingFields = [];

    const handleSubmit = async () => {
        if (!validate()) return;
        setIsSubmitting(true);
        await mockSubmit(formData, view);
        setIsSubmitting(false);
        setShowSuccess(true);
    };


            useEffect(() => {
                let timer;
                const preventTouchMove = (e) => {
                    if (showFullSig) e.preventDefault();
                };

                const initCanvas = () => {
                    const canvas = fullSigCanvasRef.current;
                    if (!canvas) return;
                    
                    const container = canvas.parentElement;
                    const rect = container.getBoundingClientRect();
                    const ratio = Math.max(window.devicePixelRatio || 1, 1);
                    canvas.width = rect.width * ratio;
                    canvas.height = rect.height * ratio;
                    canvas.style.width = rect.width + 'px';
                    canvas.style.height = rect.height + 'px';
                    
                    const ctx = canvas.getContext("2d");
                    ctx.scale(ratio, ratio);
                    ctx.fillStyle = "rgb(255,255,255)";
                    ctx.fillRect(0, 0, rect.width, rect.height);
                    
                    if (padInstance.current) padInstance.current.off();
                    padInstance.current = new SignaturePad(canvas, { 
                        penColor: "rgb(27, 54, 93)", 
                        backgroundColor: "rgb(255, 255, 255)", 
                        minWidth: 1.5,
                        maxWidth: 4.0,
                    });
                };

                if (showFullSig) {
                    document.body.style.overflow = 'hidden';
                    document.addEventListener('touchmove', preventTouchMove, { passive: false });
                    timer = setTimeout(initCanvas, 150);
                }
                
                return () => { 
                    if (timer) clearTimeout(timer);
                    if (padInstance.current) padInstance.current.off(); 
                    document.body.style.overflow = '';
                    document.removeEventListener('touchmove', preventTouchMove);
                };
            }, [showFullSig]);

            const saveSignature = () => {
                if (padInstance.current && !padInstance.current.isEmpty()) {
                    setRealtimeSig(padInstance.current.toDataURL());
                    const now = new Date();
                    const timeStr = `${now.getFullYear()}/${(now.getMonth()+1).toString().padStart(2,'0')}/${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                    handleChange('signature', padInstance.current.toDataURL());
                    handleChange('signature_time', timeStr);
                    setShowFullSig(false);
                } else {
window.showToast('è«‹å…ˆç°½å');
                }
            };

if (view === 'home') {
    return (
        <>
            <ToastContainer />
            <div className="min-h-screen relative flex flex-col font-sans">
                <main className="flex-1 px-6 pb-10 max-w-lg mx-auto w-full pt-12 md:pt-20">
<div className="text-center mb-10 animate-fade-in relative z-10">
    <img 
        src="logo.png" 
        className="w-72 md:w-96 h-auto mx-auto object-contain drop-shadow-lg mb-6 hover:scale-105 transition-transform duration-500 cursor-pointer select-none" 
        alt="Lion Pet Beauty Casa"
        onDoubleClick={() => window.location.href = 'admin.html'}
        onTouchEnd={(e) => {
            // æª¢æŸ¥æ˜¯å¦ç‚ºé›™æ“Šï¼šåˆ©ç”¨æ™‚é–“å·®åˆ¤æ–·
            const now = new Date().getTime();
            if (now - (e.target.lastTouchEnd || 0) < 300) {
                window.location.href = 'admin.html';
            }
            e.target.lastTouchEnd = now;
        }}
        onError={(e)=>{e.target.style.display='none'}}
    />
    <p className="text-lion-gold text-[10px] font-bold tracking-[0.4em] uppercase">Luxury Pet Salon</p>
</div>
                    <Marquee />
                    <div className="space-y-5 animate-fade-in" style={{animationDelay:'0.1s'}}>
                        <div onClick={() => updateHash('grooming')} className="glass-premium p-6 flex items-center gap-6 cursor-pointer hover:shadow-lg hover:border-lion-gold/30 transition-all border border-white group">
                            <div className="w-16 h-16 bg-white rounded-2xl flex items-center justify-center text-lion-navy shadow-sm border border-slate-50 group-hover:bg-lion-navy group-hover:text-white transition-colors relative z-10"><Icon name="scissors" size={28} /></div>
                            <div className="flex-1 relative z-10">
                                <h3 className="text-xl font-serif font-bold text-lion-navy group-hover:text-lion-gold transition-colors">ç²¾ç·»ç¾å®¹</h3>
                                <p className="text-slate-500 text-xs mt-1">å°ˆæ¥­é€ å‹ä¿®å‰ª Â· æ·±å±¤çš®æ¯›è­·ç†</p>
                            </div>
                            <div className="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center group-hover:bg-lion-gold group-hover:text-white transition-colors relative z-10"><Icon name="chevron-right" size={16} /></div>
                        </div>
                        <div onClick={() => updateHash('boarding')} className="glass-premium p-6 flex items-center gap-6 cursor-pointer hover:shadow-lg hover:border-lion-gold/30 transition-all border border-white group">
                            <div className="w-16 h-16 bg-[#F9F5EC] rounded-2xl flex items-center justify-center text-lion-gold shadow-sm border border-slate-50 group-hover:bg-lion-gold group-hover:text-white transition-colors relative z-10"><Icon name="home" size={28} /></div>
                            <div className="flex-1 relative z-10">
                                <h3 className="text-xl font-serif font-bold text-lion-navy group-hover:text-lion-gold transition-colors">ç²¾å“ä½å®¿</h3>
                                <p className="text-slate-500 text-xs mt-1">å¯¬æ•ç¨ç«‹ç©ºé–“ Â· 24H æº«æ¿•åº¦ç›£æ§</p>
                            </div>
                            <div className="w-8 h-8 rounded-full bg-slate-50 flex items-center justify-center group-hover:bg-lion-gold group-hover:text-white transition-colors relative z-10"><Icon name="chevron-right" size={16} /></div>
                        </div>
                    </div>
                    <div className="mt-8 grid grid-cols-3 gap-4 animate-fade-in" style={{animationDelay:'0.2s'}}>
                        <a href="tel:033608693" className="glass-premium p-4 flex flex-col items-center justify-center gap-2 hover:-translate-y-1 transition-transform border border-white group">
                            <Icon name="phone" className="text-slate-400 group-hover:text-lion-navy transition-colors" /><span className="text-[10px] font-bold text-lion-navy">æ’¥æ‰“é›»è©±</span>
                        </a>
                        <a href="https://www.facebook.com/lionbeautycasa/?locale=zh_TW" target="_blank" className="glass-premium p-4 flex flex-col items-center justify-center gap-2 hover:-translate-y-1 transition-transform border border-white group">
                            <Icon name="facebook" className="text-[#1877F2]" /><span className="text-[10px] font-bold text-lion-navy">Facebook</span>
                        </a>
                        <a href="https://lin.ee/jS3JP5z" className="glass-premium p-4 flex flex-col items-center justify-center gap-2 hover:-translate-y-1 transition-transform border border-white group">
                            <img src="https://lionpetsstore.github.io/line.png" className="w-5 h-5 object-contain" /><span className="text-[10px] font-bold text-lion-navy">åŠ å¥½å‹</span>
                        </a>
                    </div>
                    <div className="mt-8 text-center animate-fade-in" style={{animationDelay:'0.3s'}}>
                        <a href="https://maps.app.goo.gl/Kc4xdPe2KowoLcUR9" target="_blank" className="inline-flex items-center gap-2 text-lion-navy font-bold text-sm bg-white/80 backdrop-blur px-5 py-3 rounded-full shadow-sm border border-slate-100 hover:scale-105 hover:shadow-md hover:border-lion-gold/50 transition-all">
                            <Icon name="map-pin" size={18} className="text-lion-gold"/> æ¡ƒåœ’å¸‚æ¡ƒåœ’å€æ°‘æ—è·¯199-2è™Ÿ
                        </a>
                    </div>
                </main>
                <footer className="text-center py-8 text-[10px] text-slate-400 font-bold relative z-10"><p>ç‰¹å¯µæ¥­å­—ç¬¬ C1130686 è™Ÿ</p><p className="mt-1">Â© 2026 Lion Pet Beauty Casa.</p></footer>
            </div>
        </>
    );
}

return (
    <div className="min-h-screen pb-40">
        <ToastContainer />
        {showHistoryModal && (
            <HistoryModal 
                records={historyRecords} 
                onClose={() => setShowHistoryModal(false)} 
                onSelect={handleApplyHistory} 
            />
        )}
 
                        <nav className="fixed top-0 w-full z-40 bg-white/80 backdrop-blur-md border-b border-slate-200/50 shadow-sm transition-all">
                        <div className="px-6 py-4 flex justify-between items-center max-w-5xl mx-auto">
                            <div className="flex items-center gap-4 cursor-pointer group" onClick={() => updateHash('home')}>
                                <img src="logo.png" className="w-10 h-10 object-contain" onError={(e)=>{e.target.style.display='none'}}/> 
                                <span className="font-serif font-bold text-lion-navy text-lg hidden md:block">LION PET</span>
                            </div>
                            <button onClick={() => updateHash('home')} className="text-xs font-bold text-slate-600 bg-slate-100/80 px-4 py-2.5 rounded-full flex items-center gap-2 hover:bg-slate-200 transition-colors"><Icon name="arrow-left" size={16}/> è¿”å›é¦–é </button>
                        </div>
                    </nav>

                    <main className="pt-28 px-4 md:px-8 max-w-4xl mx-auto space-y-8">
                        <div className="text-center space-y-2 mb-8 relative z-10">
                            <h2 className="text-2xl md:text-3xl font-serif font-bold text-lion-navy drop-shadow-sm">{view === 'boarding' ? 'ä½å®¿æœå‹™å¡«å¯«è³‡æ–™' : 'ç¾å®¹æœå‹™å¡«å¯«è³‡æ–™'}</h2>
                            <p className="text-sm text-slate-500 font-medium">è«‹å¡«å¯«ä»¥ä¸‹è³‡è¨Šä»¥å®Œæˆé ç´„</p>
                        </div>

                        <div className="glass-premium p-6 md:p-8 border-l-4 border-lion-line shadow-sm">
                            <div className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
                                <div>
                                    <h3 className="font-bold text-lion-navy text-xl flex items-center gap-2"><img src="https://lionpetsstore.github.io/line.png" className="w-7 h-7"/> åŠ å…¥å®˜æ–¹ LINE</h3>
                                    <p className="text-sm text-slate-500 font-bold mt-1 ml-9">ID: @149veapq</p>
                                </div>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <a href="https://lin.ee/jS3JP5z" className="bg-slate-50/50 rounded-2xl p-4 text-center border hover:bg-white transition-colors group">
                                    <div className="w-8 h-8 bg-lion-line text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2 shadow-sm group-hover:scale-110 transition-transform">1</div><div className="text-base font-bold text-lion-line">é»æ“ŠåŠ å…¥å¥½å‹</div>
                                </a>
                                <div className="bg-red-50/50 rounded-2xl p-4 text-center border border-red-100">
                                    <div className="w-8 h-8 bg-red-500 text-white rounded-full flex items-center justify-center text-sm font-bold mx-auto mb-2 shadow-sm animate-pulse-slow">2</div><div className="text-base font-bold text-red-600">å‹™å¿…ã€Œå‚³é€è²¼åœ–ã€</div>
                                </div>
                            </div>
<div className="space-y-2">
    <button 
        type="button"
        onClick={() => {
            handleChange('lineAdded', !formData.lineAdded);
        }} 
        className={`w-full py-4 rounded-xl font-bold text-sm border transition-all ${formData.lineAdded ? 'bg-lion-line text-white border-lion-line shadow-md' : 'bg-white text-slate-400 border-slate-300 hover:bg-slate-50'}`}
    >
        {formData.lineAdded ? "âœ… æˆ‘å·²å®Œæˆä¸Šè¿°å…©æ­¥é©Ÿ" : "ç¢ºèªï¼šæˆ‘å·²å®Œæˆä¸Šè¿°å…©æ­¥é©Ÿ"}
    </button>
</div>

                        </div>

                        {view === 'boarding' && (
                            <section className="glass-premium p-6 md:p-8 space-y-5">
                                <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-3 flex items-center gap-2 text-lg"><Icon name="home" size={20}/> ä½å®¿ç’°å¢ƒä»‹ç´¹</h3>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div className="bg-[#FFF8E1]/60 p-5 rounded-2xl border border-[#FFE082]/30 backdrop-blur-sm"><h4 className="font-bold text-lion-navy mb-2 flex items-center gap-2 text-base"><Icon name="cat" size={18}/> ä¸€æ¨“ï¼šè²“å’ªä½å®¿</h4><p className="text-sm text-slate-600 leading-relaxed text-justify">è²“å’ªå°ˆå±¬æ¨“å±¤ï¼Œæ¯æ—¥æ¶ˆæ¯’ã€æ†æº«èˆ’é©ã€‚ç¨ç«‹ç©ºèª¿å¾ªç’°ï¼Œè®“è²“è²“å€‘èƒ½è‡ªåœ¨æ›¬å¤ªé™½ã€çª©åœ¨æŸ”è»Ÿçš„æ¯¯å­è£¡ç™¼å‘†ã€‚</p></div>
                                    <div className="bg-[#E3F2FD]/60 p-5 rounded-2xl border border-[#90CAF9]/30 backdrop-blur-sm"><h4 className="font-bold text-lion-navy mb-2 flex items-center gap-2 text-base"><Icon name="dog" size={18}/> äºŒæ¨“ï¼šç‹—ç‹—ä½å®¿</h4><p className="text-sm text-slate-600 leading-relaxed text-justify">æ¯æ—¥é™ªç©ã€å®šæ™‚æ•£æ­¥ã€‚å¤œé–“ä¿å§†å·¡æˆ¿ï¼Œä¸åªæ˜¯ã€Œå¯„æ”¾ã€ï¼Œè€Œæ˜¯è¢«ç…§é¡§ã€è¢«ç–¼æ„›ã€è¢«é™ªä¼´ã€‚</p></div>
                                </div>
                            </section>
                        )}

                        <section className="glass-premium p-6 md:p-8 space-y-6">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 flex items-center gap-3 text-lg"><Icon name="user" size={20}/> é£¼ä¸»åŸºæœ¬è³‡æ–™</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <InputWithError label="é›»å­éƒµä»¶ *" name="email" type="email" value={formData.email} onChange={e=>handleChange('email', e.target.value)} error={errors.email} placeholder="å¯„é€å¥‘ç´„å‰¯æœ¬ç”¨" />
                                <div className="grid grid-cols-[1.5fr,1fr] gap-4">
                                    <InputWithError label="ä¸»äººå§“å *" name="owner_name" value={formData.owner_name} onChange={e=>handleChange('owner_name', e.target.value)} error={errors.owner_name} />
<div className="space-y-2">
    <label className="text-xs font-bold text-lion-navy/70 ml-1 tracking-wide">æ˜¯å¦ç‚ºæœ¬äºº</label>
    <div className="flex gap-3">
        <button
            type="button"
            onClick={() => handleChange('is_owner', 'æ˜¯')}
            className={`flex-1 py-3 rounded-xl font-bold text-sm border-2 transition-all duration-200 ${
                formData.is_owner === 'æ˜¯' 
                ? 'bg-lion-navy text-white border-lion-navy shadow-md' 
                : 'bg-white text-slate-500 border-slate-200 hover:border-lion-navy/30'
            } ${errors.is_owner ? 'border-red-500' : ''}`}
        >
            æ˜¯
        </button>
        <button
            type="button"
            onClick={() => handleChange('is_owner', 'å¦')}
            className={`flex-1 py-3 rounded-xl font-bold text-sm border-2 transition-all duration-200 ${
                formData.is_owner === 'å¦' 
                ? 'bg-lion-navy text-white border-lion-navy shadow-md' 
                : 'bg-white text-slate-500 border-slate-200 hover:border-lion-navy/30'
            } ${errors.is_owner ? 'border-red-500' : ''}`}
        >
            å¦
        </button>
    </div>
    {errors.is_owner && <div className="text-xs text-red-500 font-bold mt-1 ml-1">{errors.is_owner}</div>}
</div>


                                </div>
                            </div>
<div className="space-y-6">
    <div className="space-y-2">
        <label className="text-xs font-bold text-lion-navy/70 ml-1">æ‰‹æ©Ÿè™Ÿç¢¼ *</label>
        <div className="flex flex-col sm:flex-row gap-2">
            <input 
                type="tel" 
                value={formData.phone} 
                onChange={e=>handleChange('phone', e.target.value)} 
                placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼"
                className={`w-full cute-input rounded-xl px-4 py-3.5 font-bold text-lion-navy placeholder-slate-300 ${errors.phone ? 'border-red-500 bg-red-50/50' : ''}`}
            />
            <button 
                onClick={handleSearchHistory}
                disabled={isSearching}
                className="bg-[#1B365D] text-white h-[50px] px-4 rounded-xl font-bold text-xs shadow-md hover:bg-blue-900 transition-colors whitespace-nowrap flex items-center justify-center gap-2 w-full sm:w-auto shrink-0"
            >
                {isSearching ? <Icon name="loader-2" size={16} className="animate-spin" /> : <Icon name="search" size={16} />}
                {isSearching ? 'æŸ¥è©¢ä¸­...' : 'èˆŠå®¢æŸ¥è©¢'}
            </button>
        </div>
    </div>
    
<InputWithError 
    label={view==='boarding' ? "èº«åˆ†è­‰å­—è™Ÿ (å…¥ä½è«‹æ”œå¸¶æ­£æœ¬æ ¸å°) *" : "èº«åˆ†è­‰å­—è™Ÿ *"} 
    name="owner_id" 
    value={formData.owner_id} 
    onChange={e=>handleChange('owner_id', e.target.value)} 
    error={errors.owner_id}
    placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿ"
/>

</div>
                            <InputWithError label="è¯çµ¡åœ°å€ *" name="address" value={formData.address} onChange={e=>handleChange('address', e.target.value)} error={errors.address} />
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <InputWithError label="ç·Šæ€¥è¯çµ¡äººå§“å *" name="emergency_name" value={formData.emergency_name} onChange={e=>handleChange('emergency_name', e.target.value)} error={errors.emergency_name} />
                                <InputWithError label="ç·Šæ€¥è¯çµ¡äººé›»è©± *" name="emergency_phone" value={formData.emergency_phone} onChange={e=>handleChange('emergency_phone', e.target.value)} error={errors.emergency_phone} />
                            </div>

                        </section>

                        <section className="glass-premium p-6 md:p-8 space-y-6">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 flex items-center gap-3 text-lg"><Icon name="paw-print" size={20}/> å¯µç‰©è©³ç´°è³‡æ–™</h3>
                             
<div className="space-y-2">
    <label className="text-xs font-bold text-lion-navy/70 ml-1 tracking-wide">å¯µç‰©ç¨®é¡ *</label>
    <div className={`flex p-1 bg-slate-100 rounded-xl ${errors.pet_type ? 'border-2 border-red-500' : ''}`}>
        <button 
            onClick={() => { handleChange('pet_type', 'dog'); handleChange('room_type', ''); handleChange('room_price', ''); clearError('pet_type'); }}
            className={`flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all ${formData.pet_type === 'dog' ? 'bg-lion-navy text-white shadow-md' : 'text-slate-400 hover:text-lion-navy'}`}
        >
            <Icon name="dog" size={18}/> ç‹—ç‹—
        </button>
        <button 
            onClick={() => { handleChange('pet_type', 'cat'); handleChange('room_type', ''); handleChange('room_price', ''); clearError('pet_type'); }}
            className={`flex-1 py-3 rounded-lg text-sm font-bold flex items-center justify-center gap-2 transition-all ${formData.pet_type === 'cat' ? 'bg-lion-navy text-white shadow-md' : 'text-slate-400 hover:text-lion-navy'}`}
        >
            <Icon name="cat" size={18}/> è²“å’ª
        </button>
    </div>
    {errors.pet_type && <div className="text-xs text-red-500 font-bold mt-1">{errors.pet_type}</div>}
</div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <InputWithError label="å¯µç‰©åå­— *" name="pet_name" value={formData.pet_name} onChange={e=>handleChange('pet_name', e.target.value)} error={errors.pet_name} />
                                <InputWithError label="å“ç¨® *" name="breed" value={formData.breed} onChange={e=>handleChange('breed', e.target.value)} error={errors.breed} />
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <InputWithError label="é«”é‡ (kg) *" name="weight" type="number" value={formData.weight} onChange={e=>handleChange('weight', e.target.value)} error={errors.weight} />
<div className="space-y-2">
    <label className="text-xs font-bold text-slate-500">å¹´é½¡ *</label>
    <div className="space-y-3">
        <div className={`flex gap-2 ${errors.age_type ? 'border-2 border-red-500 rounded-xl' : ''}`}>
            <button onClick={() => { handleChange('age_type', 'year'); handleChange('age_value', ''); clearError('age_type'); }} 
                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'year' ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200'}`}>
                1æ­²ä»¥ä¸Š
            </button>
            <button onClick={() => { handleChange('age_type', 'month'); handleChange('age_value', ''); clearError('age_type'); }} 
                className={`flex-1 py-2 rounded-xl text-xs font-bold border-2 transition-all ${formData.age_type === 'month' ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200'}`}>
                æœªæ»¿1æ­² (1~11å€‹æœˆ)
            </button>
        </div>
        {errors.age_type && <div className="text-xs text-red-500 font-bold mt-1">{errors.age_type}</div>}
        <div className="relative animate-slide-down">
            <input type="number" className={`w-full cute-input rounded-xl px-4 py-3 font-bold text-lion-navy ${errors.age_value ? 'border-red-500 bg-red-50/50' : ''}`} 
                placeholder={formData.age_type === 'year' ? "è«‹è¼¸å…¥å¹¾æ­² (ä¾‹å¦‚: 8)" : "è«‹è¼¸å…¥å¹¾å€‹æœˆ (ä¾‹å¦‚: 2)"} 
                value={formData.age_value} onChange={e=>handleChange('age_value', e.target.value)} />
            <span className="absolute right-4 top-3 text-lion-navy/50 font-bold text-sm pointer-events-none">
                {formData.age_type === 'year' ? 'æ­²' : 'å€‹æœˆ'}
            </span>
            {errors.age_value && <div className="text-xs text-red-500 font-bold mt-1">{errors.age_value}</div>}
        </div>
    </div>
</div>
                            </div>
                            <div className="grid grid-cols-2 gap-6">
                                <div className="space-y-2"><label className="text-xs font-bold text-slate-500">æ€§åˆ¥ *</label><div className="flex gap-2">{['å…¬','æ¯'].map(v=>(<button key={v} onClick={()=>handleChange('sex',v)} className={`flex-1 py-3 rounded-xl border text-sm font-bold transition-all ${formData.sex===v?'bg-lion-navy text-white border-lion-navy': (errors.sex ? 'bg-red-50 border-red-500 text-red-500' : 'bg-white/50 text-slate-500 border-slate-300')}`}>{v}</button>))}</div></div>
                                <div className="space-y-2"><label className="text-xs font-bold text-slate-500">çµç´® *</label><div className="flex gap-2">{['æ˜¯','å¦'].map(v=>(<button key={v} onClick={()=>handleChange('fix',v)} className={`flex-1 py-3 rounded-xl border text-sm font-bold transition-all ${formData.fix===v?'bg-lion-navy text-white border-lion-navy': (errors.fix ? 'bg-red-50 border-red-500 text-red-500' : 'bg-white/50 text-slate-500 border-slate-300')}`}>{v}</button>))}</div></div>
<div className="grid grid-cols-1 md:grid-cols-2 gap-6">
    {/* å·¦å´ï¼šè¿‘æœŸå¥æª¢ */}
    <div className="space-y-2">
        <label className="text-xs font-bold text-slate-500">è¿‘æœŸå¥æª¢</label>
        <input 
            type="date" 
            className="w-full cute-input rounded-xl px-4 py-3 text-sm font-bold text-lion-navy" 
            value={formData.health_date} 
            onChange={e=>handleChange('health_date', e.target.value)} 
        />
    </div>

    {/* å³å´ï¼šæ¯æœˆå®šæœŸé©…èŸ² */}
    <div className="space-y-2">
        <label className="text-xs font-bold text-slate-500">æ¯æœˆå®šæœŸé©…èŸ² *</label>
        <div className={`flex gap-2 ${errors.deworming_monthly ? 'border-2 border-red-500 rounded-xl' : ''}`}>
            {['æ˜¯','å¦'].map(v => (
                <button 
                    key={v} 
                    onClick={() => { handleChange('deworming_monthly', v); clearError('deworming_monthly'); }} 
                    className={`flex-1 py-3 rounded-xl border-2 text-xs font-bold transition-all ${formData.deworming_monthly === v ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-400 border-slate-200 hover:border-lion-navy/30'}`}
                >
                    {v}
                </button>
            ))}
        </div>
        {errors.deworming_monthly && <div className="text-xs text-red-500 font-bold mt-1">{errors.deworming_monthly}</div>}
    </div>
</div>
</div>
<div className="space-y-2">
    <label className="text-xs font-bold text-slate-500">å¤–è§€æª¢æŸ¥ (å¯è¤‡é¸) *</label>
    <div className={`flex flex-wrap gap-2 ${errors.physical_check ? 'border-2 border-red-500 rounded-xl p-2' : ''}`}>
        {['æ­£å¸¸', 'çš®å±‘', 'æ‰“çµ', 'ç´…è…«', 'å¯„ç”ŸèŸ²(è·³èš¤ã€å£è¨)', '+ å…¶ä»–'].map(opt => (
            <button key={opt} onClick={() => {
                let newArr = [...formData.physical_check];
                if (opt === 'æ­£å¸¸') { newArr = newArr.includes('æ­£å¸¸') ? [] : ['æ­£å¸¸']; } 
                else { if (newArr.includes('æ­£å¸¸')) newArr = []; newArr = newArr.includes(opt) ? newArr.filter(i => i !== opt) : [...newArr, opt]; }
                handleChange('physical_check', newArr);
                clearError('physical_check');
            }} className={`px-4 py-2.5 rounded-xl text-xs font-bold border-2 transition-all ${formData.physical_check.includes(opt) ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200 hover:border-lion-gold'}`}>{opt}</button>
        ))}
    </div>
    {errors.physical_check && <div className="text-xs text-red-500 font-bold mt-1">{errors.physical_check}</div>}
    {formData.physical_check.includes('+ å…¶ä»–') && <InputWithError placeholder="è«‹èªªæ˜å…¶ä»–å¤–è§€ç‹€æ³" value={formData.physical_other} onChange={e=>handleChange('physical_other', e.target.value)} className="animate-slide-down" />}
</div>


<div className="space-y-3">
    <label className="text-xs font-bold text-lion-navy/70 ml-1">å¯µç‰©å€‹æ€§ *</label>
    <div className={`space-y-3 p-4 bg-white/50 rounded-2xl border ${errors.social_traits ? 'border-2 border-red-500' : 'border-slate-100'}`}>
        <div className="flex gap-3">
            {['è¦ªäºº','ä¸è¦ªäºº'].map(opt => (
                <button 
                    key={opt} 
                    onClick={() => {
                        const clean = formData.social_traits.filter(t => !['è¦ªäºº','ä¸è¦ªäºº'].includes(t));
                        handleChange('social_traits', [...clean, opt]);
                        clearError('social_traits');
                    }} 
                    className={`flex-1 py-3 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200'}`}
                >
                    {opt}
                </button>
            ))}
        </div>
        <div className="flex gap-3">
            {['è¦ªç‹—','ä¸è¦ªç‹—'].map(opt => (
                <button 
                    key={opt} 
                    onClick={() => {
                        const clean = formData.social_traits.filter(t => !['è¦ªç‹—','ä¸è¦ªç‹—'].includes(t));
                        handleChange('social_traits', [...clean, opt]);
                        clearError('social_traits');
                    }} 
                    className={`flex-1 py-3 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200'}`}
                >
                    {opt}
                </button>
            ))}
        </div>
        <div className="flex flex-wrap gap-2">
            {personalityOptions.map(opt => (
                <button 
                    key={opt} 
                    onClick={() => {
                        toggleArray('social_traits', opt);
                        clearError('social_traits');
                    }} 
                    className={`px-4 py-2.5 rounded-xl text-xs font-bold border-2 transition-all ${formData.social_traits.includes(opt) ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200 hover:border-lion-gold'}`}
                >
                    {opt}
                </button>
            ))}
        </div>
        {formData.social_traits.includes('+ å…¶ä»–') && <InputWithError placeholder="è«‹èªªæ˜å…¶ä»–å€‹æ€§ç‹€æ³" value={formData.personality_other} onChange={e=>handleChange('personality_other', e.target.value)} className="animate-slide-down" />}
    </div>
    {errors.social_traits && <div className="text-xs text-red-500 font-bold mt-1">{errors.social_traits}</div>}
</div>
                             
{view === 'boarding' && (
    <div className="space-y-3">
        <label className="text-xs font-bold text-lion-navy/70 ml-1">æ”¾é¢¨æ¨¡å¼</label>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div onClick={()=>handleChange('temperament','å…±åŒæ”¾é¢¨')} className={`radio-card p-4 rounded-xl cursor-pointer flex items-center justify-between group ${formData.temperament==='å…±åŒæ”¾é¢¨'?'selected':''}`}><div><div className="font-bold text-sm text-lion-navy">å…±åŒæ”¾é¢¨</div><div className="text-[10px] text-slate-400 mt-1">ç„¡æ”»æ“Šæ€§ã€ç„¡ä»»ä½•å‚³æŸ“ç–¾ç—…ï¼Œå¯èˆ‡å…¶ä»–å¤¥ä¼´ç›¸è™•</div></div>{formData.temperament==='å…±åŒæ”¾é¢¨' && <Icon name="check-circle" className="text-lion-navy" size={18}/>}</div>
            <div onClick={()=>handleChange('temperament','ç¨ç«‹æ”¾é¢¨')} className={`radio-card p-4 rounded-xl cursor-pointer flex items-center justify-between group ${formData.temperament==='ç¨ç«‹æ”¾é¢¨'?'selected':''}`}><div><div className="font-bold text-sm text-lion-navy">ç¨ç«‹æ”¾é¢¨</div><div className="text-[10px] text-slate-400 mt-1">ç”±åº—å®¶å®‰æ’ç‰¹å®šæ™‚é–“å–®ç¨æ´»å‹•</div></div>{formData.temperament==='ç¨ç«‹æ”¾é¢¨' && <Icon name="check-circle" className="text-lion-navy" size={18}/>}</div>
        </div>
    </div>
)}
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-lion-navy/70 ml-1">æ™¶ç‰‡ç‹€æ…‹</label>
                                <div className="flex flex-wrap gap-2">
                                    {['æœ‰æ™¶ç‰‡', 'æœ‰æ™¶ç‰‡(è™Ÿç¢¼ä¸è©³)', 'ç„¡æ™¶ç‰‡'].map(v => (
                                        <button key={v} onClick={() => handleChange('chip_status', v)} 
                                            className={`px-4 py-3 rounded-xl border-2 text-xs font-bold transition-all flex-grow ${formData.chip_status === v ? 'bg-lion-navy text-white border-lion-navy shadow-md' : (errors.chip_status ? 'bg-red-50 border-red-500 text-red-500' : 'bg-white text-slate-500 border-slate-200')}`}>
                                            {v}
                                        </button>
                                    ))}
                                </div>
                                {formData.chip_status === 'æœ‰æ™¶ç‰‡' && <InputWithError placeholder="è«‹è¼¸å…¥æ™¶ç‰‡è™Ÿç¢¼" value={formData.chip_id} onChange={e => handleChange('chip_id', e.target.value)} className="animate-slide-down mt-2" />}
                            </div>

                            <div className="space-y-3 pt-4 border-t border-slate-100">
                                <label className="text-xs font-bold text-slate-500">éå¾€ç—…å² (å¯è¤‡é¸) *</label>
                                <div className="flex gap-2">
                                    <button onClick={()=>handleChange('medical_history', 'æœ‰')} className={`flex-1 py-3 rounded-xl border font-bold transition-all flex items-center justify-center gap-2 ${formData.medical_history==='æœ‰' ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white/50 text-slate-400 border-slate-200 hover:border-lion-gold'}`}><Icon name="check-circle" size={18} className="mb-0.5"/> æœ‰</button>
                                    <button onClick={()=>{handleChange('medical_history', 'ç„¡'); handleChange('medical_tags', []);}} className={`flex-1 py-3 rounded-xl border font-bold transition-all ${formData.medical_history==='ç„¡' ? 'bg-slate-100 text-slate-600 border-slate-200' : 'bg-white/50 text-slate-400 border-slate-200 hover:border-slate-300'}`}>ç„¡</button>
                                </div>
                                {formData.medical_history === 'æœ‰' && <div className="animate-slide-down space-y-3 bg-slate-50/50 p-5 rounded-2xl border border-slate-200"><div className="flex flex-wrap gap-2">{['å¿ƒè‡Ÿç—…','ç™²ç™‡','éæ•','æ°£å–˜','çš®è†šç—…','æ°£ç®¡å¡Œé™·','ç™½å…§éšœ','å¿ƒçµ²èŸ²','è…¹è†œç‚','è…¹ç©æ°´','è‰¾åˆ©å¸Œé«”','æ‰‹è¡“å¤–å‚·æœªç™’åˆ','é«–é—œç¯€å•é¡Œ','éª¨æŠ˜','è…¸ç‚','è¡€ä¾¿','è¡€å°¿','æ‡·å­•','å‚³æŸ“æ€§ç–¾ç—…','+ å…¶ä»–'].map(tag => (<button key={tag} onClick={()=>toggleArray('medical_tags', tag)} className={`px-3 py-1.5 rounded-lg text-xs font-bold border transition-all ${formData.medical_tags.includes(tag) ? (tag === '+ å…¶ä»–' ? 'bg-lion-gold text-white border-lion-gold' : 'bg-lion-navy text-white border-lion-navy') : 'bg-white text-slate-500 border-slate-200 hover:border-lion-navy/30'}`}>{tag}</button>))}</div>{formData.medical_tags.includes('+ å…¶ä»–') && <textarea className="w-full cute-input rounded-xl px-4 py-3 h-20 text-sm animate-fade-in focus:border-lion-gold" placeholder="è«‹è©³ç´°èªªæ˜å…¶ä»–ç—…å²..." value={formData.medical_other} onChange={e=>handleChange('medical_other', e.target.value)}></textarea>}</div>}
                            </div>
                             
                            <div className="space-y-2">
                                <label className="text-xs font-bold text-slate-500">é£¼ä¸»æŒ‡å®šé†«ç™‚é™¢æ‰€(è‹¥æœªå¡«å¯«å‰‡é€å¾€ä¹™æ–¹ç‰¹ç´„é†«é™¢)</label>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <InputWithError label="é†«é™¢åç¨±" name="preferred_clinic_name" value={formData.preferred_clinic_name || ''} onChange={e=>handleChange('preferred_clinic_name', e.target.value)} placeholder="ä¾‹ï¼šå°å¤§å‹•ç‰©é†«é™¢" />
                                    <InputWithError label="è¯çµ¡é›»è©±" name="preferred_clinic_phone" value={formData.preferred_clinic_phone || ''} onChange={e=>handleChange('preferred_clinic_phone', e.target.value)} placeholder="ä¾‹ï¼š03-123-4567" />
                                </div>
                            </div>
                        </section>

                        <section className="glass-premium p-6 md:p-8 space-y-6">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 flex items-center gap-3 text-lg"><div className="w-8 h-8 rounded-lg bg-lion-navy/10 flex items-center justify-center text-lion-navy"><Icon name="shopping-bag" size={18}/></div> æ¶ˆè²»é …ç›® (å¯è¤‡é¸)</h3>
                             
                            {view === 'boarding' && (
                                <div className="space-y-6 animate-slide-down border-b border-slate-200 pb-6">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 bg-lion-gold/10 p-5 rounded-2xl border border-lion-gold/20">
                                        <div className="space-y-1"><label className="text-xs font-bold text-lion-navy">å…¥ä½æ—¥æœŸ *</label><input type="date" className="w-full cute-input rounded-xl px-4 py-3 text-sm" value={formData.checkInDate} onChange={e=>handleChange('checkInDate', e.target.value)} /></div>
                                        <div className="space-y-1"><label className="text-xs font-bold text-lion-navy">é€€æˆ¿æ—¥æœŸ *</label><input type="date" className="w-full cute-input rounded-xl px-4 py-3 text-sm" value={formData.checkOutDate} onChange={e=>handleChange('checkOutDate', e.target.value)} /></div>
                                    </div>

                                    <div className="space-y-3">
                                        <label className="text-xs font-bold text-slate-500 ml-1">é¸æ“‡æˆ¿å‹ ({formData.pet_type === 'dog' ? 'ç‹—ç‹—' : 'è²“å’ª'}) *</label>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                            {roomRates[formData.pet_type].map((room) => (
                                                <div 
                                                    key={room.name}
                                                    onClick={() => { handleChange('room_type', room.name); handleChange('room_price', room.price); }}
                                                    className={`cursor-pointer rounded-xl p-4 border-2 transition-all relative overflow-hidden group ${formData.room_type === room.name ? 'border-lion-navy bg-white shadow-md' : (errors.room_type ? 'border-red-500 bg-red-50/50' : 'border-slate-200 bg-white/50 hover:border-lion-gold')}`}
                                                >
                                                    <div className="flex justify-between items-start mb-1">
                                                        <span className={`font-bold text-sm ${formData.room_type === room.name ? 'text-lion-navy' : 'text-slate-600'}`}>{room.name}</span>
                                                        {formData.room_type === room.name && <Icon name="check-circle" size={16} className="text-lion-gold"/>}
                                                    </div>
                                                    <div className="text-lg font-serif font-bold text-lion-navy">${room.price}<span className="text-xs font-sans font-normal text-slate-400">/æ™š</span></div>
                                                    <div className="text-[10px] text-slate-400 mt-1 font-medium">{room.desc}</div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                            )}

<div className="space-y-6">
    {view === 'grooming' && errors.service_tags && (
        <div className="text-red-500 text-sm font-bold animate-fade-in">
            è«‹è‡³å°‘é¸æ“‡ä¸€é …ç¾å®¹æœå‹™
        </div>
    )}
    <div>
        <div className="text-xs font-bold text-slate-400 mb-3 tracking-wide">åŸºç¤æœå‹™</div>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            {['æ´—æ¾¡', 'å‰ªæ¯›(å«æ´—æ¾¡)'].map(item => (<button key={item} onClick={()=>toggleArray('service_tags', item)} className={`p-4 rounded-2xl border-2 text-left transition-all ${formData.service_tags.includes(item) ? 'border-lion-navy bg-lion-navy text-white shadow-lg' : 'border-slate-200 bg-white hover:border-lion-gold'}`}><div className="font-bold text-sm">{item}</div><div className="text-[10px] opacity-70 mt-1">åŸºç¤æ¸…æ½”è­·ç†</div></button>))}
        </div>
    </div>

                                <div>
                                    <div className="text-xs font-bold text-slate-400 mb-3 tracking-wide">åŠ è³¼èˆ‡å‡ç´š</div>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                        {[
                                            {n:'åˆ·ç‰™', p:'$50'},
                                            {n:'æ•£æ­¥', p:'$100', note:'(è«‹è‡ªå‚™ä¸æœƒæ™è„«ä¹‹èƒ¸èƒŒç‰½ç¹©)', isRed:true},
                                            {n:'ç‰›å¥¶æµ´', p:'$200èµ·'}, 
                                            {n:'é…µç´ ', p:'$200èµ·'}, 
                                            {n:'ä¿®é ­', p:'$300èµ·'}, 
                                            {n:'å…¨èº«æ‰‹å‰ª', p:'$600èµ·'},
                                        ].map(item => (
                                            <button key={item.n} onClick={()=>toggleArray('service_tags', item.n)} className={`flex flex-col items-start p-3 md:p-4 rounded-xl border-2 text-xs font-bold transition-all relative overflow-hidden ${formData.service_tags.includes(item.n) ? 'bg-lion-gold text-white border-lion-gold shadow-md' : 'bg-white text-slate-600 border-slate-200 hover:border-lion-gold/50'}`}>
                                                <div className="flex justify-between w-full relative z-10"><span>{item.n}</span><span className="opacity-80">{item.p}</span></div>
                                                {item.note && <div className={`text-[9px] mt-1 relative z-10 text-left ${item.isRed ? (formData.service_tags.includes(item.n) ? 'text-white' : 'text-red-500 font-bold') : 'opacity-70'}`}>{item.note}</div>}
                                            </button>
                                        ))}
                                    </div>
                                </div>
                                <div>
                                    <div className="text-xs font-bold text-slate-400 mb-3 tracking-wide">å…¶ä»–é …ç›®</div>
                                    <div className="flex gap-3">
                                        <button onClick={()=>toggleArray('service_tags', 'å…¶ä»–')} className={`w-full py-3 rounded-xl text-xs font-bold border-2 transition-all ${formData.service_tags.includes('å…¶ä»–')?'bg-slate-600 text-white border-slate-600 shadow-md':'bg-white text-slate-500 border-slate-200 hover:bg-slate-50'}`}>å…¶ä»–</button>
                                    </div>
                                </div>
                                {formData.service_tags.includes('å…¶ä»–') && (
                                    <div className="animate-slide-down">
                                        <InputWithError label="å‚™è¨»èªªæ˜" name="note" value={formData.note} onChange={e=>handleChange('note', e.target.value)} placeholder="é‡å°ä¸Šè¿°é …ç›®è£œå……èªªæ˜..." />
                                    </div>
                                )}
                            </div>
                        </section>

                        <section className="glass-premium p-6 md:p-8 space-y-6">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 flex items-center gap-3 text-lg"><div className="w-8 h-8 rounded-lg bg-lion-navy/10 flex items-center justify-center text-lion-navy"><Icon name="dollar-sign" size={18}/></div> ä»˜æ¬¾èˆ‡é‡‘é¡ç¢ºèª</h3>
<InputWithError 
    label="æœ¬æ¬¡æ¶ˆè²»ç¸½é‡‘é¡ *" 
    type="number" 
    name="total_amount" 
    value={formData.total_amount} 
    onChange={e=>handleChange('total_amount', e.target.value)} 
    placeholder="ç”±åº—å®¶å‘ŠçŸ¥é‡‘é¡å¾Œå¡«å¯«" 
    error={errors.total_amount}
/>

<div className="space-y-2">
    <label className="text-xs font-bold text-lion-navy/70 ml-1">ä»˜æ¬¾æ–¹å¼ *</label>
    <div className={`flex gap-3 ${errors.payment_method ? 'border-2 border-red-500 rounded-xl' : ''}`}>
        {['ç¾é‡‘','è½‰å¸³'].map(opt => (
            <button 
                key={opt} 
                onClick={() => {
                    handleChange('payment_method', opt);
                    clearError('payment_method');
                }} 
                className={`flex-1 py-3.5 rounded-xl border-2 text-sm font-bold transition-all ${formData.payment_method === opt ? 'bg-lion-navy text-white border-lion-navy shadow-md' : 'bg-white text-slate-500 border-slate-200 hover:border-slate-300'}`}
            >
                {opt}
            </button>
        ))}
    </div>
    {errors.payment_method && <div className="text-xs text-red-500 font-bold mt-1">{errors.payment_method}</div>}
</div>

{view === 'boarding' && (
    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 animate-slide-down">
        <InputWithError label="å·²æ”¯ä»˜è¨‚é‡‘ *" type="number" name="deposit" value={formData.deposit} onChange={e=>handleChange('deposit', e.target.value)} placeholder="$0" error={errors.deposit} />
        <InputWithError label="å°¾æ¬¾é‡‘é¡ *" type="number" name="balance" value={formData.balance} onChange={e=>handleChange('balance', e.target.value)} placeholder="$0" error={errors.balance} />
    </div>
)}
                        </section>

                        <section className="glass-premium p-6 md:p-8 space-y-5 text-sm text-slate-600">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 text-lg">ä¹™æ–¹ï¼ˆåº—å®¶è³‡è¨Šï¼‰</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-50/50 p-5 rounded-2xl border border-slate-100">
                                <p className="flex items-center gap-2"><Icon name="briefcase" size={16} className="text-lion-gold"/><span className="font-bold text-lion-navy">åç¨±ï¼š</span>ä½³æ™Ÿå¯µç‰©ç¾å®¹æ—…é¤¨</p>
                                <p className="flex items-center gap-2"><Icon name="user" size={16} className="text-lion-gold"/><span className="font-bold text-lion-navy">è² è²¬äººï¼š</span>é¡ç¿è«º</p>
                                <p className="flex items-center gap-2"><Icon name="phone" size={16} className="text-lion-gold"/><span className="font-bold text-lion-navy">é›»è©±ï¼š</span>03-360-8693</p>
                                <p className="md:col-span-2 flex items-start gap-2"><Icon name="map-pin" size={16} className="text-lion-gold mt-0.5 shrink-0"/><span className="font-bold text-lion-navy">åœ°å€ï¼š</span>æ¡ƒåœ’å¸‚æ¡ƒåœ’å€æ°‘æ—è·¯199-2è™Ÿ</p>
                                <p className="flex items-center gap-2"><Icon name="file-text" size={16} className="text-lion-gold"/><span className="font-bold text-lion-navy">ç‰¹å¯µæ¥­å­—ç¬¬C1130686è™Ÿ</span></p>
                            </div>
                            <div className="bg-red-50 p-5 rounded-xl text-slate-600 text-xs border border-red-100 space-y-2">
                                <h4 className="font-bold text-red-600 text-sm flex items-center gap-2"><Icon name="ambulance" size={18}/> ä¹™æ–¹æŒ‡å®šé†«ç™‚é™¢æ‰€</h4>
                                <p><span className="font-bold">åç¨±ï¼š</span>å®‰æ¬£å‹•ç‰©é†«é™¢</p>
                                <p><span className="font-bold">é›»è©±ï¼š</span>03-333-6775</p>
                                <p><span className="font-bold">åœ°å€ï¼š</span>æ¡ƒåœ’å¸‚æ¡ƒåœ’å€ä¸­ç¦è¡—60è™Ÿ</p>
                            </div>
                            <div className="mt-3 pt-3 border-t border-red-100 text-justify">
    <p className="text-[11px] leading-relaxed">
        è‹¥ç¶“åˆ¤å®šæƒ…æ³å±æ€¥æˆ–è·é›¢ä¹‹é™åˆ¶ä¸å®œå‰å¾€ç”²æ–¹æŒ‡å®šä¹‹é†«é™¢ï¼Œå°‡å°±è¿‘ç”±ä¹™æ–¹æŒ‡å®šä¹‹é†«é™¢é€²è¡Œæ•‘æ²»ï¼Œå°±é†«å‰é ˆå…ˆé€šçŸ¥ç”²æ–¹ã€‚
    </p>
</div>
                        </section>

                        <section className="glass-premium p-6 md:p-8 space-y-5">
                            <h3 className="font-bold text-lion-navy border-b border-slate-200 pb-4 text-lg">æ³•å¾‹æ¢æ¬¾èˆ‡ç°½ç½²</h3>
                             
<button 
    onClick={() => setActiveModal('beauty')} 
    className={`w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all group shadow-sm bg-white relative z-10 ${termsRead.beauty ? 'border-lion-line/50' : 'border-lion-navy hover:bg-lion-navy/5'}`}
>
    <div className="flex items-center gap-4">
        <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-colors ${termsRead.beauty ? 'bg-lion-line text-white' : 'bg-lion-navy/10 text-lion-navy'}`}>
            <Icon name={termsRead.beauty ? "check" : "file-text"} size={24}/>
        </div>
        <div className="text-left">
            <div className="font-bold text-base text-lion-navy">ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾</div>
            <div className="text-xs text-slate-400 mt-0.5">{termsRead.beauty ? 'å·²å®Œæˆé–±è®€èˆ‡ç°½ç½²' : 'è«‹é»æ“Šè©³é–±å…§å®¹'}</div>
        </div>
    </div>
    <div className={`px-3 py-1.5 rounded-lg text-xs font-bold ${termsRead.beauty ? 'bg-lion-line/10 text-lion-line' : 'bg-lion-navy text-white'}`}>
        {termsRead.beauty ? 'å·²åŒæ„' : 'å¾…é–±è®€'}
    </div>
</button>

                            {view === 'boarding' && (
                                <button onClick={() => setActiveModal('boarding')} className={`w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all group shadow-sm bg-white animate-slide-down ${termsRead.boarding ? 'border-lion-line/50' : 'border-lion-navy hover:bg-lion-navy/5'}`}>
                                    <div className="flex items-center gap-4">
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-colors ${termsRead.boarding ? 'bg-lion-line text-white' : 'bg-lion-navy/10 text-lion-navy'}`}><Icon name={termsRead.boarding ? "check" : "home"} size={24}/></div>
                                        <div className="text-left">
                                            <div className="font-bold text-base text-lion-navy">ä½å®¿/å®‰è¦ªå¥‘ç´„æ¢æ¬¾</div>
                                            <div className="text-xs text-slate-400 mt-0.5">{termsRead.boarding ? 'å·²å®Œæˆé–±è®€èˆ‡ç°½ç½²' : 'è«‹é»æ“Šè©³é–±å…§å®¹'}</div>
                                        </div>
                                    </div>
                                    <div className={`px-3 py-1.5 rounded-lg text-xs font-bold ${termsRead.boarding ? 'bg-lion-line/10 text-lion-line' : 'bg-lion-navy text-white'}`}>{termsRead.boarding ? 'å·²åŒæ„' : 'å¾…é–±è®€'}</div>
                                </button>
                            )}

                            {isHighRisk && (
                                <button onClick={() => setActiveModal('highRiskBeauty')} className={`w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all group shadow-sm bg-white animate-slide-down ${termsRead.highRiskBeauty ? 'border-lion-line/50' : 'border-red-400 hover:bg-red-50'}`}>
                                    <div className="flex items-center gap-4">
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-colors ${termsRead.highRiskBeauty ? 'bg-lion-line text-white' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                            <Icon name={termsRead.highRiskBeauty ? "check" : "alert-triangle"} size={24}/>
                                        </div>
                                        <div className="text-left">
                                            <div className="font-bold text-base text-lion-navy">é«˜é¢¨éšªç¾å®¹æœå‹™åŒæ„æ›¸</div>
                                            <div className="text-xs font-bold text-red-500 mt-0.5">{termsRead.highRiskBeauty ? 'å·²å®Œæˆç°½ç½²' : 'è«‹é»æ“Šè©³é–±ä¸¦åŒæ„'}</div>
                                        </div>
                                    </div>
                                    <div className={`px-3 py-1.5 rounded-lg text-xs font-bold ${termsRead.highRiskBeauty ? 'bg-lion-line/10 text-lion-line' : 'bg-red-500 text-white'}`}>{termsRead.highRiskBeauty ? 'å·²åŒæ„' : 'å¾…ç°½ç½²'}</div>
                                </button>
                            )}

                            {isHighRisk && view === 'boarding' && (
                                <button onClick={() => setActiveModal('highRiskBoarding')} className={`w-full flex items-center justify-between p-5 rounded-2xl border-2 transition-all group shadow-sm bg-white animate-slide-down ${termsRead.highRiskBoarding ? 'border-lion-line/50' : 'border-red-400 hover:bg-red-50'}`}>
                                    <div className="flex items-center gap-4">
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center transition-colors ${termsRead.highRiskBoarding ? 'bg-lion-line text-white' : 'bg-red-100 text-red-500 animate-pulse'}`}>
                                            <Icon name={termsRead.highRiskBoarding ? "check" : "alert-triangle"} size={24}/>
                                        </div>
                                        <div className="text-left">
                                            <div className="font-bold text-base text-lion-navy">é«˜é¢¨éšªä½å®¿æœå‹™åŒæ„æ›¸</div>
                                            <div className="text-xs font-bold text-red-500 mt-0.5">{termsRead.highRiskBoarding ? 'å·²å®Œæˆç°½ç½²' : 'è«‹é»æ“Šè©³é–±ä¸¦åŒæ„'}</div>
                                        </div>
                                    </div>
                                    <div className={`px-3 py-1.5 rounded-lg text-xs font-bold ${termsRead.highRiskBoarding ? 'bg-lion-line/10 text-lion-line' : 'bg-red-500 text-white'}`}>{termsRead.highRiskBoarding ? 'å·²åŒæ„' : 'å¾…ç°½ç½²'}</div>
                                </button>
                            )}

<div className="space-y-4 pt-6 border-t border-slate-200" id="signature">
    <div className="flex items-center justify-between">
        <label className="text-sm font-bold text-lion-navy flex items-center gap-2">
            <Icon name="pen-tool" size={18}/> æ•¸ä½ç°½å *
        </label>
        {realtimeSig && (
            <button type="button" onClick={() => setRealtimeSig(null)} className="text-xs font-bold text-red-400 hover:text-red-500 flex items-center gap-1 transition-colors bg-red-50 px-3 py-1.5 rounded-full">
                <Icon name="trash-2" size={14}/> é‡ç°½
            </button>
        )}
    </div>
    
    {realtimeSig ? (
        <div className="space-y-3 animate-fade-in">
            <div className="bg-white rounded-2xl border-2 border-lion-navy/20 p-6 flex justify-center items-center min-h-[180px] shadow-inner relative overflow-hidden">
                <div className="absolute inset-0 opacity-5 bg-[radial-gradient(#1B365D_1px,transparent_1px)] [background-size:16px_16px]"></div>
                <img src={realtimeSig} alt="æ‚¨çš„ç°½å" className="max-h-[150px] object-contain relative z-10" />
            </div>
            <div className="flex items-center justify-end gap-3">
                <div className="bg-green-100 text-green-700 px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1.5 shadow-sm border border-green-200">
                    <Icon name="check-circle" size={14}/> å·²ç°½ç½²
                </div>
                <div className="text-xs text-slate-400 font-bold bg-slate-50 px-3 py-1.5 rounded-full border border-slate-100">
                    æ™‚é–“ï¼š{new Date().toLocaleString('zh-TW', { hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}
                </div>
            </div>
        </div>
    ) : (
        <button type="button" onClick={() => { if(allTermsCompleted) setShowFullSig(true); else window.window.showToast('è«‹å…ˆå®Œæˆä¸Šæ–¹æ‰€æœ‰å¥‘ç´„æ¢æ¬¾é–±è®€', 'error'); }} 
            className={`w-full min-h-[180px] rounded-2xl border-2 border-dashed flex flex-col items-center justify-center gap-3 transition-all group ${errors.signature ? 'border-red-500 bg-red-50/50' : (allTermsCompleted ? 'border-lion-navy/30 bg-white hover:border-lion-navy hover:bg-lion-gold/5 cursor-pointer' : 'border-slate-200 bg-slate-50 cursor-not-allowed opacity-60')}`}>
            <div className={`w-16 h-16 rounded-full flex items-center justify-center transition-all ${allTermsCompleted ? 'bg-lion-navy/5 text-lion-navy group-hover:scale-110 group-hover:bg-lion-gold/20' : 'bg-slate-200 text-slate-400'}`}>
                <Icon name={allTermsCompleted ? "pen-tool" : "lock"} size={28}/>
            </div>
            <span className={`text-sm font-bold ${allTermsCompleted ? 'text-lion-navy' : 'text-slate-400'}`}>{allTermsCompleted ? "é»æ“Šæ­¤è™•é–‹å§‹ç°½å" : "è«‹å…ˆå®Œæˆä¸Šæ–¹æ¢æ¬¾é–±è®€"}</span>
            <span className="text-xs text-slate-400">{allTermsCompleted ? "å°‡é–‹å•Ÿå…¨è¢å¹•ç°½åæ¿" : "é–±è®€ä¸¦åŒæ„å¾Œè§£é–"}</span>
        </button>
    )}
    {errors.signature && <div className="text-xs text-red-500 font-bold mt-1">{errors.signature}</div>}
</div>

                            <button onClick={handleSubmit} disabled={isSubmitting} className="w-full py-5 bg-gradient-to-r from-lion-navy to-[#2A4B7C] text-white rounded-2xl font-bold text-lg shadow-xl shadow-lion-navy/30 active:scale-95 transition-all flex items-center justify-center gap-3 hover:shadow-2xl disabled:opacity-70 disabled:cursor-not-allowed transform hover:-translate-y-1">{isSubmitting ? 'è³‡æ–™æäº¤ä¸­...' : 'ç¢ºèªä¸¦æäº¤é ç´„å–®'} <Icon name="send" size={20}/></button>
                        </section>
                    </main>

                    <TermsModal isOpen={activeModal === 'beauty'} onClose={() => setActiveModal(null)} title="ç¾å®¹æœå‹™å¥‘ç´„æ¢æ¬¾" onAgree={() => handleTermAgree('beauty')}>
                        <div className="space-y-4">
                            <p className="font-bold text-lion-navy text-lg border-b pb-2 mb-4">ç¾å®¹æœå‹™ ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</p>
                            <ol className="list-decimal pl-5 space-y-3 marker:text-lion-gold marker:font-bold pb-4 text-justify text-slate-600 text-sm">
                                <li><strong>ç¬¬ä¸€æ¢(å¥‘ç´„ç›®çš„)ï¼š</strong>æœ¬æœå‹™ç‚ºçŠ¬è²“ç¾å®¹ï¼Œ<span className="text-red-500 font-bold underline">ä¸æ¶‰åŠé†«ç™‚è¡Œç‚º</span>ã€‚</li>
                                <li><strong>ç¬¬äº”æ¢(å¥åº·å‘ŠçŸ¥)ï¼š</strong>ç”²æ–¹æ‡‰<span className="font-bold underline">èª å¯¦å‘ŠçŸ¥</span>å¯µç‰©ç—…å²èˆ‡æ˜¯å¦å…·æœ‰æ”»æ“Šæ€§ã€‚è‹¥å› éš±çå°è‡´æ„å¤–ï¼Œ<span className="text-red-500 font-bold">ä¹™æ–¹ä¸è² è²¬æå®³è³ å„Ÿè²¬ä»»</span>ï¼›å› éš±çå°è‡´ä¹™æ–¹äººå“¡å‚·äº¡ã€è²¡æç­‰æå¤±ï¼Œ<span className="text-red-500 font-bold underline">ä¹™æ–¹å°‡å…¨é¡å‘ç”²æ–¹æ±‚å„Ÿ</span>ã€‚</li>
                                <li><strong>ç¬¬ä¹æ¢(é€€è²»è¦å®š)ï¼š</strong>åŒ…æœˆæœå‹™çµ‚æ­¢æ™‚ï¼Œé æ”¶ç¸½é¡æ‰£é™¤(<span className="font-bold text-lion-navy">å·²ä½¿ç”¨æ¬¡æ•¸ X å–®æ¬¡åŸåƒ¹</span>)å¾Œé€€è²»ã€‚</li>
                                <li><strong>ç¬¬åäºŒæ¢(é€¾æ™‚æ¥å›)ï¼š</strong>è‹¥æ–¼ç´„å®šæ™‚é–“å…§æœªé ˜å›ï¼Œ<span className="text-red-500 font-bold">åŠ æ”¶å®‰è¦ªè²»</span>ï¼›æ‰“çƒŠæ™‚ä»æœªæ¥å›ï¼Œå‰‡<span className="text-red-500 font-bold">è¦–åŒä½å®¿ä¸€æ™šè¨ˆè²»</span>ã€‚å¦‚ç¶“é€šçŸ¥ä¸‰æ—¥å…§æœªé ˜å›ï¼Œå°‡ä¾ç…§<span className="font-bold underline">å‹•ä¿æ³•ç¬¬29æ¢</span>ç§»äº¤ä¸»ç®¡æ©Ÿé—œã€‚</li>
                                <li><strong>ç¬¬åäº”æ¢(å±¥ç´„ä¿éšœ)ï¼š</strong>é æ”¶è²»ç”¨ç´¯ç©é‡‘é¡æ–°å°å¹£ä¸€è¬å…ƒä»¥ä¸‹ï¼Œä¾æ³•å…æä¾›å±¥ç´„ä¿éšœã€‚</li>
                                <li>å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</li>
                                <li>å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥<span className="font-bold">æ¡ƒåœ’åœ°æ–¹æ³•é™¢</span>ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                            </ol>
                            <div className="mt-6 p-4 bg-slate-50 rounded-xl border border-slate-200 text-xs text-slate-500 space-y-1">
                                <p>â–  ç¶“ç”²ä¹™é›™æ–¹åˆæ„ç´„å®šï¼Œç”±ç”²æ–¹å³æ™‚é–±è®€ç†è§£æœ¬å¥‘ç´„å…§å®¹ä¸¦ç°½ç½²ã€‚</p>
                                <p>â–  ç¶“ç”²æ–¹æœ¬äººå·²ç¢ºèªé è¨ˆæ¥å›æ™‚é–“èˆ‡æœå‹™é‡‘é¡ç„¡èª¤ï¼Œä¸¦åŒæ„ä¸Šè¿°æ¢æ¬¾ã€‚</p>
                            </div>
                        </div>
                    </TermsModal>

{/* Modals - High Risk Beauty */}
                    <TermsModal isOpen={activeModal === 'highRiskBeauty'} onClose={() => setActiveModal(null)} title="é«˜é¢¨éšªç¾å®¹æœå‹™é¢¨éšªå‘ŠçŸ¥æš¨åŒæ„è²æ˜" onAgree={() => handleTermAgree('highRiskBeauty')}>
                        <div className="space-y-6">
                            <div className="space-y-2">
                                <h4 className="font-bold text-lion-navy border-b pb-1 text-base">ä¸€ã€é£¼ä¸»èª å¯¦å‘ŠçŸ¥ç¾©å‹™</h4>
                                <p className="text-justify leading-relaxed">æœ¬äººï¼ˆç”²æ–¹ï¼‰ç¢ºèªï¼Œå·²å°±æœ¬äººæ‰€çŸ¥æ‚‰ä¹‹å¯µç‰©å¹´é½¡ã€éå¾€ç—…å²ï¼ˆå¦‚å¿ƒè‡Ÿç—…ã€ç™²ç™‡ã€æ°£å–˜ã€é—œç¯€å•é¡Œç­‰ï¼‰ã€è¿‘æœŸæ‰‹è¡“æˆ–æ²»ç™‚ç´€éŒ„ã€æ‡·å­•ç‹€æ³ã€éæ•åæ‡‰ï¼Œä»¥åŠè¡Œç‚ºç‰¹æ€§ï¼ˆå¦‚å’¬äººç´€éŒ„ã€ç‰¹å®šéƒ¨ä½æ•æ„Ÿã€æŠ—æ‹’ä¿å®šç­‰ï¼‰ï¼Œå‘ è²´åº—ï¼ˆä¹™æ–¹ï¼‰ç‚ºå®Œæ•´ä¸”çœŸå¯¦ä¹‹èªªæ˜ã€‚å¦‚å› ç”²æ–¹æœªå‘ŠçŸ¥ã€æœªå®Œå…¨å‘ŠçŸ¥æˆ–æä¾›ä¸å¯¦è³‡è¨Šï¼Œè‡´ä¹™æ–¹æ–¼å·²ç›¡åˆç†å°ˆæ¥­æ³¨æ„ç¾©å‹™ä¹‹æƒ…å½¢ä¸‹ï¼Œä»é›£ä»¥é è¦‹æˆ–é˜²ç¯„é¢¨éšªç™¼ç”Ÿè€…ï¼Œå…¶ç›¸é—œè²¬ä»»æ­¸å±¬ï¼Œé›™æ–¹åŒæ„ä¾å¯¦éš›æƒ…å½¢åŠç›¸é—œæ³•å¾‹è¦å®šèªå®šï¼Œä¸”é ˆè³ å„Ÿå› éš±çå°è‡´æœå‹™çŠ¬ã€è²“éš»äººå“¡å—å‚·çš„ç›¸é—œé†«ç™‚è²»ç”¨ã€ç²¾ç¥è³ å„Ÿã€ç„¡æ³•å·¥ä½œæå¤±ä¹‹è²»ç”¨ã€‚</p>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-bold text-lion-navy border-b pb-1 text-base">äºŒã€é«˜é½¡èˆ‡ç‰¹æ®Šå¥åº·ç‹€æ³ä¹‹é¢¨éšªå‘ŠçŸ¥</h4>
                                <p className="text-justify leading-relaxed">æœ¬äººçŸ¥æ‚‰ï¼Œé«˜é½¡ã€å¹¼é½¡æˆ–æ‚£æœ‰æ…¢æ€§ç—…ä¹‹å¯µç‰©å°å£“åŠ›è€å—åº¦è¼ƒä½ã€‚ç¾å®¹éç¨‹ä¸­å¯èƒ½å› ç·Šå¼µæˆ–é«”èƒ½è² è·èª˜ç™¼<span className="text-red-600 font-bold underline">ä¼‘å…‹ã€èˆŠç–¾å¾©ç™¼æˆ–ä¸å¯é æœŸä¹‹æ„å¤–</span>ã€‚æœ¬äººåŒæ„ï¼šè‹¥ä¸åˆ©çµæœæºæ–¼å¯µç‰©è‡ªèº«ç‹€æ³ä¸”ä¹™æ–¹ç„¡æ•…æ„éå¤±ï¼Œ<span className="text-red-600 font-bold">ä¹™æ–¹ä¸è² æå®³è³ å„Ÿè²¬ä»»</span>ã€‚</p>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-bold text-lion-navy border-b pb-1 text-base">ä¸‰ã€æ”»æ“Šæ€§èˆ‡è¡Œç‚ºå®‰å…¨é˜²è­·åŒæ„</h4>
                                <p className="text-justify leading-relaxed">å¦‚å¯µç‰©æ–¼æœå‹™éç¨‹ä¸­å‡ºç¾é«˜åº¦ç·Šå¼µã€æ”»æ“Šè¡Œç‚ºã€éåº¦èºå‹•æˆ–å…¶ä»–å½±éŸ¿äººå“¡åŠå¯µç‰©å®‰å…¨ä¹‹æƒ…å½¢ï¼Œæœ¬äººåŒæ„ä¸¦æˆæ¬Šä¹™æ–¹ï¼ŒåŸºæ–¼å®‰å…¨è€ƒé‡ï¼Œæ¡å–å¿…è¦ä¹‹é˜²è­·èˆ‡ä¿å®šæªæ–½ï¼ˆåŒ…å«ä½†ä¸é™æ–¼ç‰½ç¹©ä¿å®šã€ä¼Šè‰èç™½é ¸åœˆã€å˜´å¥—æˆ–é›™äººå”åŒä½œæ¥­ï¼‰ã€‚è‹¥ç¶“å°ˆæ¥­åˆ¤æ–·èªç‚ºç¹¼çºŒæœå‹™æå±åŠå¯µç‰©æˆ–äººå“¡å®‰å…¨ï¼Œä¹™æ–¹å¾—éš¨æ™‚ä¸­æ­¢æœå‹™ï¼Œä¸¦ä¾å·²å®Œæˆä¹‹æœå‹™å…§å®¹èˆ‡é€²åº¦è¨ˆæ”¶è²»ç”¨ã€‚è‹¥å› é«˜åº¦ç·Šå¼µå°è‡´çŠ¬éš»ã€è²“éš»åœ¨æœå‹™éç¨‹ä¸­ï¼Œä¸å¹¸ç™¼ç”Ÿä»»ä½•å±åŠç”Ÿå‘½çš„æƒ…æ³ï¼Œå°‡<span className="text-red-600 font-bold">ä¸åœ¨è³ å„Ÿç¯„åœå…§</span>ã€‚</p>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-bold text-lion-navy border-b pb-1 text-base">å››ã€ç·Šæ€¥é†«ç™‚è™•ç½®åŒæ„</h4>
                                <p className="text-justify leading-relaxed">æœå‹™æœŸé–“å¦‚å¯µç‰©ç™¼ç”Ÿèº«é«”ä¸é©æˆ–ç·Šæ€¥ç‹€æ³ï¼Œæœ¬äººåŒæ„ä¹™æ–¹å¾—å„ªå…ˆå°‡å¯µç‰©é€å¾€æœ¬äººæŒ‡å®šæˆ–å°±è¿‘ä¹‹åˆé©å‹•ç‰©é†«é™¢é€²è¡Œç·Šæ€¥è™•ç½®ï¼Œç›¸é—œé†«ç™‚åŠå¿…è¦äº¤é€šè²»ç”¨ï¼Œç”±æœ¬äººä¾æ³•è² æ“”ã€‚</p>
                            </div>
                            <div className="space-y-2">
                                <h4 className="font-bold text-lion-navy border-b pb-1 text-base">äº”ã€é£¼ä¸»ç¢ºèª</h4>
                                <p className="text-justify leading-relaxed font-bold text-lion-navy">æœ¬äººå·²è©³é–±ä¸¦å……åˆ†ç†è§£ä¸Šè¿°æ‰€æœ‰å…§å®¹ï¼Œç¢ºèªå·²å°±ç›¸é—œé¢¨éšªç²å¾—èªªæ˜ï¼Œä¸¦æ–¼å¯©æ…è©•ä¼°å¾Œï¼ŒåŒæ„å°‡å¯µç‰©äº¤ä»˜ä¹™æ–¹é€²è¡Œç¾å®¹æœå‹™ã€‚</p>
                            </div>
                        </div>
                    </TermsModal>

{/* Modals - High Risk Boarding */}
                    <TermsModal isOpen={activeModal === 'highRiskBoarding'} onClose={() => setActiveModal(null)} title="é«˜é¢¨éšªä½å®¿æœå‹™é¢¨éšªå‘ŠçŸ¥æš¨åŒæ„è²æ˜" onAgree={() => handleTermAgree('highRiskBoarding')}>
                        <div className="space-y-6">
                            {/* ç´…è‰²è­¦ç¤ºå€å¡Šï¼šå¤©ç”Ÿç—…å²èˆ‡éš±çå¾Œæœ */}
                            <div className="p-4 bg-red-50 border border-red-100 rounded-xl text-justify shadow-sm">
                                <div className="flex items-start gap-2 mb-2">
                                    <Icon name="alert-triangle" className="text-red-500 shrink-0 mt-1" size={18} />
                                    <h4 className="font-bold text-red-600">å¥åº·ç‹€æ³èˆ‡é¢¨éšªæ‰¿æ“”</h4>
                                </div>
                                <p className="text-sm text-slate-700 leading-relaxed">
                                    ç¾å®¹æ´—æ¾¡æˆ–ä½å®¿æœŸé–“ï¼Œå› åŸºå› æˆ–æœ¬èº«éºå‚³å•é¡Œé€ æˆçš„ç–¾ç—…ï¼Œæˆ–å¯µç‰©å› å¤©ç”Ÿç—…å²ã€é«˜é½¡ã€å¹¼çŠ¬è²“ï¼Œå› å¯µç‰©æŒæœ‰äººéºæ¼ã€éš±çï¼Œæˆ–å·²çŸ¥é¢¨éšªã€ä»ç„¶å …æŒç¾å®¹æˆ–ä½å®¿ï¼Œé€”ä¸­è‹¥æœ‰æ„å¤–ä¼‘å…‹æˆ–å…¶ä»–ç­‰ç‹€æ³ï¼Œæœ¬åº—æœƒç«‹å³é€è‡³é™„è¿‘å‹•ç‰©é†«é™¢æ•‘æ²»ã€‚
                                </p>
                            </div>

                            {/* å…è²¬è²æ˜ */}
                            <ul className="space-y-4 list-disc pl-4 marker:text-red-500 text-slate-600 text-justify">
                                <li className="pl-1">
                                    å¯µç‰©è‹¥å› ä»¥ä¸Šå› ç´ å°è‡´ç–¾ç—…æˆ–æ­»äº¡ç­‰å•é¡Œç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡ <span className="font-bold text-lion-navy">èŠæ©å¯µç‰©æ²™é¾ç²¾å“æ—…é¤¨</span> ç„¡é—œï¼Œé€é†«é€”ä¸­æˆ–åˆ°é™¢æ²»ç™‚æ‰€ç”¢ç”Ÿä¹‹ç›¸é—œè²»ç”¨ï¼Œéƒ½éœ€ç”±å¯µç‰©æŒæœ‰äººè² æ“”ã€‚
                                </li>
                                <li className="pl-1">
                                    <span className="font-bold text-lion-navy border-b-2 border-red-200">é 24 å°æ™‚ç…§è­·è²æ˜ï¼š</span>
                                    <br/>
                                    å¯µç‰©æŒæœ‰äººå·²çŸ¥æœ¬åº—ç„¡ 24 å°æ™‚ä¹‹æœå‹™ï¼Œå› æ­¤ä½å®¿æœŸé–“è‹¥æ–¼æ™šä¸Šç„¡äººç…§è­·æ™‚ï¼Œç™¼ç”Ÿå•é¡Œå°è‡´ç„¡å³æ™‚æ•‘æ²»ï¼Œæˆ–å› ä½å®¿æˆ–ç¾å®¹æœŸé–“å¯µç‰©æœ¬èº«ç„¦æ…®ã€æƒ…ç·’ä¸ç©©é€ æˆè‡ªå·±æœ‰å‚·å®³ç™¼ç”Ÿï¼Œéƒ½å°‡èˆ‡ <span className="font-bold text-lion-navy">èŠæ©å¯µç‰©æ²™é¾ç²¾å“æ—…é¤¨</span> ç„¡é—œã€‚
                                </li>
                                <li className="pl-1">
                                    å€˜è‹¥ç™¼ç”Ÿæ³•å¾‹ä¸Šä¹‹ç³¾ç´›ï¼Œè¨´è¨Ÿç­‰ç›¸é—œå•é¡Œï¼Œæœ¬åˆ‡çµæ›¸æœƒä»¥è­‰æ“šä¹‹è­‰æ˜å‘ˆä¸Šç›¸é—œæ³•å¾‹éƒ¨é–€ã€‚
                                </li>
                            </ul>
                        </div>
                    </TermsModal>

                    <TermsModal isOpen={activeModal === 'boarding'} onClose={() => setActiveModal(null)} title="ä½å®¿/å®‰è¦ªå¥‘ç´„æ¢æ¬¾" onAgree={() => handleTermAgree('boarding')}>
                        <div className="space-y-4">
                            <p className="font-bold text-lion-navy text-lg border-b pb-2 mb-4">ä½å®¿/å®‰è¦ª ç°½ç½²è²æ˜èˆ‡æ³•å¾‹ç´„å®š</p>
                            <p className="text-sm font-bold text-slate-500 mb-2">ç‚ºç¢ºä¿é›™æ–¹æ¬Šåˆ©ï¼Œä»¥ä¸‹å…§å®¹è«‹å‹™å¿…è©³è®€ï¼Œä¸€æ—¦å®Œæˆç°½ç½²å³å…·æœ‰æ³•å¾‹æ•ˆåŠ›</p>
                            <ol className="list-decimal pl-5 space-y-3 marker:text-lion-gold marker:font-bold pb-4 text-justify text-slate-600 text-sm">
                                <li>
                                    <strong>ä½å®¿è¨ˆè²»èˆ‡é€²é€€æˆ¿ï¼š</strong>æœ¬é¤¨ä½å®¿æœå‹™ä»¥ã€Œæ™šã€ç‚ºè¨ˆç®—å–®ä½ã€‚è¾¦ç†å…¥ä½æ™‚é–“ç‚º 10:00 è‡³ 18:00ï¼Œé€€æˆ¿æ™‚é–“æ‡‰æ–¼ 18:00 å‰ã€‚
                                    <div className="mt-2 p-3 bg-gray-50 rounded-lg border border-gray-100 space-y-1 text-[11px]">
                                        <p className="font-bold text-lion-navy underline underline-offset-2">é€¾æ™‚è²»ç”¨è¦å®šï¼š</p>
                                        <p>â€¢ å‡¡æ–¼ 18:00 è‡³ 19:00 é–“æ¥å›è€…ï¼Œå°‡ä¾æœ¬é¤¨å…¬å‘ŠåŠ æ”¶ã€Œå®‰è¦ªè²»ç”¨ã€ã€‚</p>
                                        <p>â€¢ å‡¡è¶…éæ¯æ—¥æ‰“çƒŠæ™‚é–“ 19:00 ä»æœªæ¥å›è€…ï¼Œä¸è«–åŸæœå‹™é …ç›®ç‚ºä½•ï¼ˆå«å®‰è¦ªã€ç¾å®¹ã€æ´—æ¾¡æˆ–ä½å®¿ï¼‰ï¼Œå‡è¦–åŒæ–¼æœ¬æ—…é¤¨ã€Œä½å®¿ä¸€æ™šã€ï¼Œä¸¦ä¾ç¾å ´å…¬å‘Šä¹‹ä½å®¿è²»ç‡è¨ˆè²»ã€‚</p>
                                    </div>
                                </li>
                                <li>ä½å®¿æœŸé–“è«‹<span className="font-bold underline">è‡ªå‚™é£¼æ–™</span>ã€‚è‹¥ç„¡è‡ªå‚™è€Œç”±åº—å…§æä¾›ï¼Œå°è‡´æ›é£Ÿè…¸èƒƒä¸é©ï¼ˆå¦‚è»Ÿä¾¿ã€è…¹ç€‰ï¼‰ï¼Œ<span className="text-red-500 font-bold">æ—…é¤¨æ•ä¸è² è²¬è³ å„Ÿ</span>ã€‚</li>
                                <li>å…¥ä½ç•¶æ—¥éœ€å®Œæˆæœ¬é¤¨<span className="font-bold underline">ç¾å®¹éƒ¨æ´—è­·</span>ï¼ˆè²»ç”¨å¦è¨ˆï¼‰ã€‚è‹¥ç™¼ç¾å¯„ç”ŸèŸ²ï¼Œå°‡<span className="text-red-500 font-bold">é¡å¤–æ”¶å–é™¤èŸ²åŠç’°å¢ƒæ¸…æ½”è²»</span>ã€‚</li>
                                <li>è«‹æä¾›<span className="font-bold underline">èº«åˆ†è­‰ä»¶å½±æœ¬</span>åŠæ¯›å­©é é˜²é‡æ‰‹å†Šå‚™æŸ¥ã€‚</li>
                                <li>é€¾æœŸä¸‰æ—¥è¯ç¹«ä¸ä¸Šé£¼ä¸»ï¼Œå°‡ä¾<span className="font-bold underline">å‹•ä¿æ³•</span>äº¤ä»˜å‹•ä¿è™•ï¼Œè¡ç”Ÿè²»ç”¨ç”±<span className="text-red-500 font-bold underline">é£¼ä¸»å…¨é¡æ”¯ä»˜</span>ã€‚</li>
                                <li>è‹¥éš±çæ”»æ“Šè¡Œç‚ºå°è‡´å‚·äº¡æˆ–è²¡æï¼Œ<span className="text-red-500 font-bold">æœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿ</span>ã€‚</li>
                                <li>è‹¥å¯µç‰©æŒçºŒå å«å½±éŸ¿ç‡Ÿé‹æˆ–å®‰å¯§ï¼Œæœ¬é¤¨å°‡è¯ç¹«é£¼ä¸»æˆ–ç·Šæ€¥è¯çµ¡äºº<span className="text-red-500 font-bold underline">å…ˆè¡Œå¸¶å›</span>ã€‚</li>
                                <li>çªç™¼ç–¾ç—…é ˆé€é†«æ™‚ï¼Œç›¸é—œ<span className="text-red-500 font-bold underline">é†«ç™‚åŠäº¤é€šè²»ç”¨ç”±é£¼ä¸»å…¨é¡è² æ“”</span>ã€‚</li>
                                <li>éš±çç—…æ³æˆ–æœ¬èº«å…·æœ‰é«˜é¢¨éšªç–¾ç—…ï¼ˆå¿ƒè‡Ÿç—…ã€ç™²ç™‡ç­‰ï¼‰ï¼Œè‹¥ç™¼ç”Ÿæ„å¤–æˆ–æ­»äº¡ï¼Œç¶“åˆ¤å®šæœ¬é¤¨ç„¡ç–å¤±ï¼Œ<span className="text-red-500 font-bold">æœ¬é¤¨ä¸è² è²¬è³ å„Ÿè²¬ä»»</span>ã€‚</li>
                                <li>è‹¥å› äººç‚ºç–å¤±å°è‡´èµ°å¤±ã€å‚·äº¡ï¼Œæœ¬é¤¨ä¾æ³•è³ å„Ÿï¼Œ<span className="text-red-500 font-bold underline">è³ å„Ÿä¸Šé™ç‚ºæ–°å°å¹£ 30,000 å…ƒæ•´</span>ï¼ˆç©è€å°å‚·ç—•é™¤å¤–ï¼‰ã€‚</li>
                                <li>è‹¥åº—å…§ç‰©å“ï¼ˆæ”å½±æ©Ÿã€æˆ¿é–“éš”é–“ç­‰ï¼‰é­åˆ°ç ´å£ï¼Œ<span className="text-red-500 font-bold underline">æœ¬é¤¨æœ‰æ¬Šå‘é£¼ä¸»å…¨é¡æ±‚å„Ÿ</span>ã€‚</li>
                                <li>å¯µç‰©è‹¥å› å¹´è€æˆ–èˆŠç–¾æ­»äº¡ï¼Œè«‹æ–¼ 24 å°æ™‚å…§é ˜å›ã€‚è‹¥éœ€é‘‘å®šæ­»å› è«‹æ–¼ 24 å°æ™‚å…§æœƒåŒè¾¦ç†ï¼Œ<span className="font-bold underline">é€¾æœŸä¸å¾—ç•°è­°</span>ã€‚</li>
                                <li>æ•£æ­¥æ™‚è‹¥å› å¯µç‰©æ™è„«ç‰½ç¹©å°è‡´é€ƒè·‘æˆ–å‚·äº¡ï¼Œ<span className="text-red-500 font-bold">æœ¬é¤¨ä¸è² è²¬ç›¸é—œè³ å„Ÿäº‹å®œ</span>ã€‚</li>
                                <li>å…¶é¤˜ç´°ç¯€å°‡ä¾ç…§è¡Œæ”¿é™¢è¾²å§”æœƒå®šå‹åŒ–å¥‘ç´„ç¯„æœ¬è¾¦ç†ã€‚</li>
                                <li>æœ¬åŒæ„æ›¸ä¸€å¼å…©ä»½ï¼Œç”±é£¼ä¸»èˆ‡æœ¬é¤¨å„åŸ·ä¹™ä»½ã€‚å› æœ¬å¥‘ç´„æ‰€ç”¢ç”Ÿä¹‹è¨´è¨Ÿï¼Œé›™æ–¹åˆæ„å°‡ä»¥æ¡ƒåœ’åœ°æ–¹æ³•é™¢ç‚ºç¬¬ä¸€å¯©ç®¡è½„æ³•é™¢ã€‚</li>
                            </ol>
                            <div className="mt-6 p-4 bg-slate-50 rounded-xl border border-slate-200 text-xs text-slate-500 space-y-1">
                                <p>â–  ç¶“ç”²ä¹™é›™æ–¹åˆæ„ç´„å®šï¼Œç”±ç”²æ–¹å³æ™‚é–±è®€ç†è§£æœ¬å¥‘ç´„å…§å®¹ä¸¦ç°½ç½²ã€‚</p>
                                <p>â–  ç¶“ç”²æ–¹æœ¬äººå·²ç¢ºèªé è¨ˆæ¥å›æ™‚é–“èˆ‡æœå‹™é‡‘é¡ç„¡èª¤ï¼Œä¸¦åŒæ„ä¸Šè¿°æ¢æ¬¾ã€‚</p>
                            </div>
                        </div>
                    </TermsModal>

                    {showFullSig && (
                        <div className="fullscreen-signature animate-fade-in"><div className="p-4 bg-lion-navy text-white flex justify-between items-center shrink-0 shadow-md safe-area-top"><span className="font-bold text-lg flex items-center gap-3"><Icon name="pen-tool" size={24}/> è«‹åœ¨æ­¤ç°½å</span><button onClick={()=>setShowFullSig(false)} className="p-2 hover:bg-white/10 rounded-full transition-colors"><Icon name="x" size={28}/></button></div><div className="flex-1 bg-slate-100 relative p-4">
                                <div className="absolute inset-4 bg-white rounded-3xl shadow-xl border border-slate-200 overflow-hidden">
                                    <canvas ref={fullSigCanvasRef} className="w-full h-full block cursor-crosshair"></canvas>
                                </div>
                                <div className="absolute bottom-6 right-6 text-slate-300 text-xs font-bold pointer-events-none">LION PET SIGNATURE</div>
                            </div><div className="p-6 bg-white border-t flex gap-4 shrink-0 safe-area-bottom"><button onClick={()=>{padInstance.current.clear()}} className="flex-1 py-4 bg-slate-100 font-bold text-slate-500 rounded-xl hover:bg-slate-200 transition-colors text-lg">æ¸…é™¤é‡å¯«</button><button onClick={saveSignature} className="flex-[2] py-4 bg-lion-navy font-bold text-white rounded-xl shadow-lg hover:bg-[#2A4B7C] transition-colors text-lg">ç¢ºèªç°½å</button></div></div>
                    )}

                    {showSuccess && (
                        <div className="fixed inset-0 z-[200] bg-lion-navy/40 backdrop-blur-md flex items-center justify-center p-4"><div className="bg-white rounded-[2.5rem] p-10 max-w-sm w-full text-center space-y-8 animate-slide-down shadow-2xl relative overflow-hidden"><div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-lion-gold to-lion-navy"></div><div className="w-28 h-28 bg-green-50 rounded-full flex items-center justify-center mx-auto text-green-500 mb-4 shadow-inner"><Icon name="check" size={56} strokeWidth={3} /></div><div><h3 className="text-3xl font-serif font-bold text-lion-navy mb-3">é ç´„æˆåŠŸï¼</h3><p className="text-slate-500 text-base leading-relaxed">æ‚¨çš„è³‡æ–™å·²æˆåŠŸé€å‡ºã€‚<br/>æˆ‘å€‘æœƒç›¡å¿«é€éé›»è©±æˆ– LINE èˆ‡æ‚¨ç¢ºèªã€‚</p></div><button onClick={() => window.location.reload()} className="w-full py-5 bg-lion-navy text-white rounded-2xl font-bold shadow-xl hover:bg-[#2A4B7C] transition-colors text-lg">è¿”å›é¦–é </button></div></div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
