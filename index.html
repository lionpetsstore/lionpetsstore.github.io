<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <title>LIONPETSSTORE | æ•¸ä½å¥‘ç´„ç³»çµ±</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.7/dist/signature_pad.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            /* å“ç‰Œä¸»è‰²ï¼šæ·±ç¤¦è— (å–è‡ª Logo) */
            --brand-navy: #1B2A41; 
            /* æ¥µå…‰æ¼¸å±¤è‰²ï¼šæ·±è— -> å¯¶çŸ³é’ */
            --aurora-gradient: linear-gradient(135deg, #1B2A41 0%, #2D5F7C 100%);
            /* éŒ¯èª¤ç´… */
            --error-red: #ef4444;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F8FAFC; /* æ¥µæ·¨ç°ç™½ */
            color: var(--brand-navy);
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: contain;
        }
        
        .font-eng { font-family: 'Montserrat', sans-serif; }

        /* --- èƒŒæ™¯å…‰æšˆ --- */
        .ambient-light {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100vh;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.08; /* éå¸¸é€šé€ï¼Œåƒå½±å­ */
            animation: float 15s infinite ease-in-out alternate;
        }
        .orb-1 { width: 600px; height: 600px; background: #1B2A41; top: -30%; right: -20%; }
        .orb-2 { width: 500px; height: 500px; background: #4A90E2; bottom: -20%; left: -20%; animation-delay: -5s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, -20px) scale(1.05); }
        }

        /* --- æ°´æ™¶å®¹å™¨ (ä¸»æ¡†æ¶) --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.65);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            border-radius: 2.5rem;
            box-shadow: 0 20px 50px -15px rgba(27, 42, 65, 0.1);
        }

        /* --- Lion è¼¸å…¥æ¡† --- */
        .lion-input {
            background: #fff;
            border: 1px solid #E2E8F0;
            border-radius: 0.75rem;
            transition: all 0.3s;
            width: 100%;
            padding: 12px 16px;
            font-weight: 500;
            color: var(--brand-navy);
        }
        .lion-input:focus {
            border-color: #2D5F7C;
            outline: none;
            box-shadow: 0 0 0 4px rgba(45, 95, 124, 0.1);
        }
        .lion-input.input-error {
            border-color: var(--error-red);
            background-color: #fef2f2;
        }

        /* --- é¸é …æŒ‰éˆ• (Pill) --- */
        .lion-option {
            border: 1px solid #E2E8F0;
            background: white;
            color: #64748b;
            padding: 12px;
            border-radius: 0.75rem;
            text-align: center;
            font-weight: bold;
            transition: all 0.2s;
            cursor: pointer;
        }
        .lion-option.selected {
            background: var(--brand-navy);
            color: white;
            border-color: var(--brand-navy);
            box-shadow: 0 4px 12px rgba(27, 42, 65, 0.2);
        }

        /* --- æœå‹™æŒ‰éˆ• --- */
        .service-btn {
            position: relative;
            overflow: hidden;
            border-radius: 1.5rem;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #E2E8F0;
            box-shadow: 0 4px 6px -1px rgba(27, 42, 65, 0.03);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 18px;
        }
        .service-btn:active { transform: scale(0.98); }
        .service-btn:hover {
            border-color: #2D5F7C;
            background: #fff;
            box-shadow: 0 10px 30px -5px rgba(45, 95, 124, 0.15);
        }
        .icon-box {
            width: 54px; height: 54px;
            border-radius: 16px;
            display: flex; align-items: center; justify-content: center;
            background: var(--aurora-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(27, 42, 65, 0.15);
            transition: transform 0.3s ease;
        }
        .service-btn:hover .icon-box { transform: scale(1.05); }

        /* --- çµ±ä¸€è¯çµ¡æŒ‰éˆ• (Unified Contact Button) --- */
        .unified-btn {
            width: 100%;
            padding: 16px;
            border-radius: 1.2rem;
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid #E2E8F0;
            color: var(--brand-navy);
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .unified-btn:hover {
            background: #fff;
            border-color: var(--brand-navy);
            box-shadow: 0 8px 20px -5px rgba(27, 42, 65, 0.1);
            transform: translateY(-2px);
        }

        .unified-btn:active { transform: scale(0.98); }

        /* --- é€šç”¨è¼”åŠ© --- */
        .logo-img { width: 100%; max-width: 240px; margin: 0 auto; display: block; filter: contrast(1.05); }
        .one-line-clamp { white-space: nowrap; display: block; transform-origin: center center; transform: scale(0.9); width: 110%; margin-left: -5%; text-align: center; }
        .field-error { color: var(--error-red); font-size: 12px; margin-top: 4px; display: flex; align-items: center; gap: 4px; font-weight: bold; }
        .fullscreen-signature { position: fixed; inset: 0; z-index: 100; background: #F8FAFC; display: flex; flex-direction: column; }
        
        /* éœ‡å‹•å‹•ç•« */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-4px); } 75% { transform: translateX(4px); } }
        .shake-error { animation: shake 0.4s ease-in-out; }
        
        /* Modal å‹•ç•« */
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-enter { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="relative min-h-screen flex justify-center py-4 px-4 md:py-8">
    
    <div class="ambient-light">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <div id="root" class="relative z-10 w-full max-w-lg glass-panel overflow-hidden min-h-[85vh] flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const supabase = window.supabase.createClient('https://fpkzuotxxbsqisgwupix.supabase.co', 'sb_publishable_VsAJfSi7Fb3zu_A5Ksm2wA_mAUkDLBs'); 

        // Icon Component
        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (typeof window.lucide !== 'undefined' && iconRef.current) {
                    window.lucide.createIcons({ root: iconRef.current, attrs: { "stroke-width": 2, class: className }, name: name, nameAttr: 'data-lucide' });
                }
            }, [name, className]);
            return <span ref={iconRef} className="inline-flex items-center justify-center"><i data-lucide={name} style={{ width: size, height: size }}></i></span>;
        };

        // Input Component
        const InputWithError = ({ name, type = 'text', value, onChange, placeholder, error, className = '', ...props }) => (
            <div className="space-y-1">
                <input name={name} type={type} value={value} onChange={onChange} className={`lion-input ${error ? 'input-error shake-error' : ''} ${className}`} placeholder={placeholder} {...props} />
                {error && <div className="field-error"><Icon name="alert-circle" size={12} />{error}</div>}
            </div>
        );

        // Terms Modal (Lion Style)
        const TermsModal = ({ isOpen, onClose, title, children, onAgree }) => {
            const contentRef = useRef(null);
            const [canAgree, setCanAgree] = useState(false);

            useEffect(() => {
                if (isOpen) {
                    setCanAgree(false);
                    document.body.style.overflow = 'hidden';
                    setTimeout(() => {
                        if (contentRef.current && contentRef.current.scrollHeight <= contentRef.current.clientHeight + 1) setCanAgree(true);
                    }, 500);
                } else { document.body.style.overflow = ''; }
            }, [isOpen]);

            const handleScroll = (e) => {
                const { scrollTop, scrollHeight, clientHeight } = e.target;
                if (scrollHeight - scrollTop - clientHeight < 50) setCanAgree(true);
            };

            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[150] bg-black/60 backdrop-blur-sm flex items-end justify-center">
                    <div className="bg-white w-full md:max-w-lg h-[85vh] rounded-t-[2.5rem] flex flex-col shadow-2xl relative modal-enter">
                        <div className="px-6 py-5 border-b border-slate-100 flex justify-between items-center">
                            <h3 className="font-bold text-lg text-[#1B2A41]">{title}</h3>
                            <button onClick={onClose} className="p-2 bg-slate-50 rounded-full hover:bg-slate-100"><Icon name="x" size={20}/></button>
                        </div>
                        <div ref={contentRef} onScroll={handleScroll} className="flex-1 overflow-y-auto p-6 space-y-4 text-sm text-slate-600 leading-relaxed">
                            {children}
                            <div className="h-10"></div>
                        </div>
                        <div className="p-6 border-t border-slate-100 bg-white pb-10">
                            {!canAgree && <div className="text-center text-xs text-blue-400 mb-2 font-bold animate-pulse">ğŸ‘‡ è«‹æ»‘å‹•è‡³åº•éƒ¨ä»¥åŒæ„æ¢æ¬¾</div>}
                            <button onClick={() => { if(canAgree) { onAgree(); onClose(); }}} disabled={!canAgree}
                                className={`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all ${canAgree ? 'bg-[#1B2A41] text-white shadow-lg' : 'bg-slate-200 text-slate-400 cursor-not-allowed'}`}>
                                <Icon name="check-circle" size={18}/> æœ¬äººå·²è©³é–±ä¸¦åŒæ„
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [view, setView] = useState('entry');
            const [isBoarding, setIsBoarding] = useState(false);
            const [formData, setFormData] = useState({
                owner_name: '', phone: '', pet_name: '', breed: '', weight: '', age: '', sex: '', fix: '',
                checkin_date: '', checkout_date: '', service_type: '', legal_agree: false,
                email: '', address: '', emergency_name: '', emergency_phone: '',
                is_under_one: false, age_months: '', chip_status: '', chip_id: '',
                grooming_temperament: '', dog_traits: [], medical_status: '', medical_history: [],
                is_barking: '', stay_exp: '', food_aggr: '', pad_toilet: '', vaccine: '', deworm: '', crate_status: [],
                boarding_notice_agree: false
            });
            const [errors, setErrors] = useState({});
            const [showFullSig, setShowFullSig] = useState(false);
            const [realtimeSig, setRealtimeSig] = useState(null);
            const [activeModal, setActiveModal] = useState(null);
            const [termsRead, setTermsRead] = useState({ boarding: false, grooming: false });
            const sigPadRef = useRef(null);
            const fullSigCanvasRef = useRef(null);

            const allTermsRead = useMemo(() => {
                if (!termsRead.grooming) return false;
                if (isBoarding && !termsRead.boarding) return false;
                return true;
            }, [isBoarding, termsRead]);

            useEffect(() => {
                const handleHashChange = () => {
                    const hash = window.location.hash;
                    if (hash === '#boarding') { setView('client'); setIsBoarding(true); }
                    else if (hash === '#grooming') { setView('client'); setIsBoarding(false); }
                    else { setView('entry'); setIsBoarding(false); }
                    window.scrollTo({top: 0, behavior: 'smooth'});
                };
                handleHashChange();
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            const navigateTo = (type) => window.location.hash = type === 'boarding' ? '#boarding' : '#grooming';

            // ç°½åæ¿é‚è¼¯
            useEffect(() => {
                if (showFullSig && fullSigCanvasRef.current) {
                    const canvas = fullSigCanvasRef.current;
                    const ratio = Math.max(window.devicePixelRatio || 1, 1);
                    canvas.width = canvas.offsetWidth * ratio;
                    canvas.height = canvas.offsetHeight * ratio;
                    const ctx = canvas.getContext("2d");
                    ctx.scale(ratio, ratio);
                    sigPadRef.current = new SignaturePad(canvas, { minWidth: 2, maxWidth: 4, penColor: '#1B2A41' });
                }
            }, [showFullSig]);

            const handleChange = (field, val) => {
                setFormData(prev => ({...prev, [field]: val}));
                if(errors[field]) setErrors(prev => ({...prev, [field]: null}));
            };

            const toggleArrayField = (field, value) => {
                setFormData(prev => {
                    const currentArr = Array.isArray(prev[field]) ? prev[field] : [];
                    let updatedArr = currentArr.includes(value) ? currentArr.filter(i => i !== value) : [...currentArr, value];
                    return { ...prev, [field]: updatedArr };
                });
            };

            const handleSubmit = async () => {
                const newErrors = {};
                // ç°¡æ˜“é©—è­‰ç¤ºç¯„ (å®Œæ•´é‚è¼¯è«‹åƒç…§ index.html)
                if (!formData.owner_name) newErrors.owner_name = "è«‹è¼¸å…¥å§“å";
                if (!formData.phone) newErrors.phone = "è«‹è¼¸å…¥é›»è©±";
                if (!formData.pet_name) newErrors.pet_name = "è«‹è¼¸å…¥å¯µç‰©åå­—";
                if (!allTermsRead) newErrors.legal_agree = "è«‹å…ˆè©³é–±æ¢æ¬¾";
                if (!realtimeSig) newErrors.signature = "è«‹ç°½å";
                
                if (Object.keys(newErrors).length > 0) {
                    setErrors(newErrors);
                    alert("è«‹æª¢æŸ¥æ¬„ä½æ˜¯å¦å¡«å¯«å®Œæ•´");
                    return;
                }
                
                alert("æäº¤æˆåŠŸï¼(åŠŸèƒ½å·²æ•´åˆï¼Œè«‹é€£æ¥å¾Œç«¯)");
            };

            // --- Entry View (é¦–é ) ---
            if (view === 'entry') {
                return (
                    <div className="flex flex-col h-full">
                        <div className="pt-12 pb-4 flex flex-col items-center relative px-6">
                            <div className="mb-4 w-full flex justify-center">
                                <img src="logo.png" alt="LIONPETSSTORE" className="logo-img" 
                                    onError={(e) => e.target.src = 'https://placehold.co/544x320/transparent/1B2A41?text=LION+LOGO'} />
                            </div>
                            
                            <h1 className="font-eng text-xl font-black tracking-widest text-[#1B2A41] mb-1">LIONPETSSTORE</h1>
                            <p className="text-slate-400 text-[10px] font-bold tracking-[0.2em] uppercase">Premium Pet Salon & Hotel</p>
                            
                            {/* è³‡è¨Šå€å¡Š (ç½®æ–¼æŒ‰éˆ•ä¸Šæ–¹) */}
                            <div className="mt-8 flex flex-col items-center gap-4 w-full">
                                <span className="inline-block text-[10px] font-bold text-[#1B2A41] border border-[#1B2A41]/20 px-4 py-1.5 rounded-full tracking-wider bg-white/40">
                                    ç‰¹å¯µæ¥­å­—ç¬¬ C1130686 è™Ÿ
                                </span>

                                <div className="text-center w-full space-y-1">
                                    <div className="flex items-center justify-center gap-2">
                                        <Icon name="shield-check" size={16} className="text-[#1B2A41]" />
                                        <span className="text-xs font-bold text-[#1B2A41]">åš´é¸ Hyponic ä½æ•æ´—åŠ‘</span>
                                        <span className="text-[9px] text-white px-2 py-0.5 rounded shadow-sm tracking-wide font-medium" 
                                              style={{ background: 'var(--aurora-gradient)' }}>
                                            Excellent
                                        </span>
                                    </div>
                                    <p className="text-[9px] text-slate-500 font-medium one-line-clamp">
                                        ä½¿ç”¨éŸ“åœ‹é ‚ç´šå“ç‰Œï¼Œæ¦®ç² å¾·åœ‹ Dermatest çš®è†šç§‘æ•æ„Ÿæ€§æ¸¬è©¦æœ€é«˜ç´šåˆ¥èªè­‰ã€‚
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* æœå‹™æŒ‰éˆ• */}
                        <main className="px-6 pb-8 w-full space-y-6 flex-grow relative flex flex-col justify-center">
                            <div className="grid gap-4 mt-2">
                                <button onClick={() => navigateTo('grooming')} className="service-btn group cursor-pointer">
                                    <div className="flex items-center gap-5">
                                        <div className="icon-box">
                                            <Icon name="scissors" size={24}/>
                                        </div>
                                        <div className="text-left">
                                            <h3 className="font-bold text-lg text-[#1B2A41]">æ²™é¾ç¾å®¹</h3>
                                            <p className="text-xs text-slate-400 mt-0.5 font-eng font-bold tracking-widest group-hover:text-[#2D5F7C] transition-colors">GROOMING</p>
                                        </div>
                                    </div>
                                    <div className="text-slate-300 group-hover:text-[#1B2A41] transition-colors">
                                        <Icon name="chevron-right" size={20}/>
                                    </div>
                                </button>

                                <button onClick={() => navigateTo('boarding')} className="service-btn group cursor-pointer">
                                    <div className="flex items-center gap-5">
                                        <div className="icon-box">
                                            <Icon name="home" size={24}/>
                                        </div>
                                        <div className="text-left">
                                            <h3 className="font-bold text-lg text-[#1B2A41]">ç²¾å“ä½å®¿</h3>
                                            <p className="text-xs text-slate-400 mt-0.5 font-eng font-bold tracking-widest group-hover:text-[#2D5F7C] transition-colors">BOARDING</p>
                                        </div>
                                    </div>
                                    <div className="text-slate-300 group-hover:text-[#1B2A41] transition-colors">
                                        <Icon name="chevron-right" size={20}/>
                                    </div>
                                </button>
                            </div>

                            {/* è¯çµ¡å€å¡Š (Unified Style) */}
                            <div className="pt-2 grid gap-3">
                                <a href="https://line.me/R/ti/p/lin.ee/jS3JP5z" className="unified-btn group">
                                    <Icon name="message-circle" size={20} className="text-[#06C755] group-hover:scale-110 transition-transform"/> 
                                    <span>LINE å®˜æ–¹å¸³è™Ÿ</span>
                                </a>
                                
                                <div className="grid grid-cols-2 gap-3">
                                    <a href="tel:033608693" className="unified-btn group">
                                        <Icon name="phone" size={18} className="text-[#1B2A41] group-hover:scale-110 transition-transform"/> 
                                        <span>æ’¥æ‰“é›»è©±</span>
                                    </a>
                                    <a href="https://www.facebook.com/lionbeautycasa/?locale=zh_TW" target="_blank" className="unified-btn group">
                                        <Icon name="facebook" size={18} className="text-[#1877F2] group-hover:scale-110 transition-transform"/> 
                                        <span>ç²‰çµ²å°ˆé </span>
                                    </a>
                                </div>
                            </div>
                        </main>
                        
                        <footer className="text-center py-4 border-t border-slate-200/50">
                            <p className="text-[10px] text-slate-400 font-eng">æ¡ƒåœ’å¸‚æ¡ƒåœ’å€æ°‘æ—è·¯199-2è™Ÿ</p>
                            <p className="text-[9px] text-slate-300 mt-1 font-eng">Â© LIONPETSSTORE 2024</p>
                        </footer>
                    </div>
                );
            }

            // --- Client View (è¡¨å–®) ---
            return (
                <div className="min-h-screen pb-20">
                    <nav className="sticky top-0 z-40 bg-white/80 backdrop-blur-md border-b border-slate-200 px-4 py-3 flex items-center justify-between shadow-sm">
                         <div className="flex items-center gap-3">
                            <button onClick={()=>window.history.back()} className="p-2 -ml-2 rounded-full hover:bg-slate-100 text-[#1B2A41]">
                                <Icon name="arrow-left" size={20}/>
                            </button>
                            <span className="font-bold text-[#1B2A41] font-serif tracking-wide">{isBoarding ? 'å®‰è¦ªä½å®¿å¥‘ç´„' : 'ç¾å®¹æœå‹™å¥‘ç´„'}</span>
                         </div>
                         <div className="w-8 h-8 rounded-full overflow-hidden border border-slate-200 bg-white p-0.5">
                            <img src="logo.png" className="w-full h-full object-contain" />
                         </div>
                    </nav>

                    <main className="px-5 py-6 max-w-xl mx-auto space-y-6">
                        
                        {/* LINE Section (ä¿®æ­£ï¼šèˆ‡é¦–é çµ±ä¸€é¢¨æ ¼) */}
                        <section className="space-y-3 mb-6">
                            <a href="https://line.me/R/ti/p/lin.ee/jS3JP5z" className="unified-btn group">
                                <Icon name="message-circle" size={20} className="text-[#06C755] group-hover:scale-110 transition-transform"/> 
                                <span>LINE å®˜æ–¹å¸³è™Ÿ</span>
                            </a>
                        </section>

                        <section className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-5">
                            <h3 className="font-bold text-[#1B2A41] flex items-center gap-2 border-b border-slate-100 pb-3"><Icon name="user" className="text-[#2D5F7C]"/> å®¶é•·è³‡æ–™</h3>
                            <InputWithError name="owner_name" placeholder="å®¶é•·å§“å" value={formData.owner_name} onChange={e=>handleChange('owner_name', e.target.value)} error={errors.owner_name} />
                            <InputWithError name="phone" placeholder="è¯çµ¡é›»è©±" value={formData.phone} onChange={e=>handleChange('phone', e.target.value)} error={errors.phone} type="tel" />
                        </section>

                        <section className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-5">
                            <h3 className="font-bold text-[#1B2A41] flex items-center gap-2 border-b border-slate-100 pb-3"><Icon name="dog" className="text-[#2D5F7C]"/> å¯¶è²è³‡æ–™</h3>
                            <InputWithError name="pet_name" placeholder="å¯µç‰©åå­—" value={formData.pet_name} onChange={e=>handleChange('pet_name', e.target.value)} error={errors.pet_name} />
                            <div className="grid grid-cols-2 gap-4">
                                <div className={`lion-option ${formData.sex==='å…¬'?'selected':''}`} onClick={()=>setFormData({...formData, sex:'å…¬'})}>å…¬</div>
                                <div className={`lion-option ${formData.sex==='æ¯'?'selected':''}`} onClick={()=>setFormData({...formData, sex:'æ¯'})}>æ¯</div>
                            </div>
                        </section>

                        {/* æ¢æ¬¾èˆ‡ç°½å */}
                        <section className="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm space-y-5">
                            <h3 className="font-bold text-[#1B2A41] flex items-center gap-2 border-b border-slate-100 pb-3"><Icon name="file-text" className="text-[#2D5F7C]"/> æ¢æ¬¾ç°½ç½²</h3>
                            
                            <button onClick={()=>setActiveModal('grooming')} className={`w-full py-4 border rounded-xl font-bold flex items-center justify-between px-4 transition-all ${formData.legal_agree ? 'border-green-500 text-green-600 bg-green-50' : 'border-slate-200 text-slate-400 hover:bg-slate-50'}`}>
                                <span>{formData.legal_agree ? 'å·²è©³é–±æœå‹™æ¢æ¬¾' : 'è©³é–±æœå‹™æ¢æ¬¾'}</span>
                                <Icon name={formData.legal_agree ? "check" : "chevron-right"} size={18}/>
                            </button>

                            <button onClick={()=>setShowFullSig(true)} className={`w-full py-10 border-2 border-dashed rounded-xl flex flex-col items-center justify-center gap-2 transition-all ${realtimeSig ? 'border-green-500 bg-green-50' : 'border-slate-200 text-slate-400 hover:bg-slate-50'}`}>
                                {realtimeSig ? <img src={realtimeSig} className="h-16 object-contain"/> : <><Icon name="pen-tool"/> <span>é»æ“Šç°½å</span></>}
                            </button>
                        </section>

                        <div className="pt-4 pb-10">
                            <button onClick={handleSubmit} className="w-full py-4 bg-[#1B2A41] text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 hover:bg-[#2D5F7C] transition-all">
                                <Icon name="send" size={18}/> æäº¤å¥‘ç´„
                            </button>
                        </div>
                    </main>

                    {showFullSig && (
                        <div className="fullscreen-signature">
                            <div className="p-4 flex justify-between items-center bg-[#1B2A41] text-white">
                                <span>è«‹ç°½å</span>
                                <button onClick={()=>setShowFullSig(false)}><Icon name="x"/></button>
                            </div>
                            <div className="flex-1 p-4 relative bg-slate-100">
                                <canvas ref={fullSigCanvasRef} className="w-full h-full bg-white rounded-2xl border border-slate-300 shadow-inner"></canvas>
                            </div>
                            <div className="p-4 bg-white flex gap-3">
                                <button onClick={()=>{sigPadRef.current.clear()}} className="flex-1 py-3 bg-slate-100 rounded-xl font-bold text-slate-600">é‡ç°½</button>
                                <button onClick={()=>{
                                    if(!sigPadRef.current.isEmpty()) {
                                        setRealtimeSig(sigPadRef.current.toDataURL());
                                        setShowFullSig(false);
                                    }
                                }} className="flex-[2] py-3 bg-[#1B2A41] text-white rounded-xl font-bold">ç¢ºèª</button>
                            </div>
                        </div>
                    )}

                    <TermsModal isOpen={!!activeModal} onClose={()=>setActiveModal(null)} title="æœå‹™æ¢æ¬¾" onAgree={()=>setFormData({...formData, legal_agree: true})} >
                        <p>1. æœ¬åº—æœå‹™å…¬ç´„...</p>
                        <p>2. å®‰å…¨å…è²¬è²æ˜...</p>
                        <p>(æ­¤è™•è«‹å¡«å…¥å®Œæ•´æ¢æ¬¾å…§å®¹)</p>
                    </TermsModal>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
